import{u as T,r as N,a as c,h as y,bl as S,d as R,o as j,w as C,a5 as P,t as E,c as l}from"./index.c5429249.js";import{C as b}from"./index.97f03277.js";import{_ as D}from"./lodash.084a01e7.js";import{B as x}from"./index.3b9f9e63.js";import{a as v,b as U,d as z}from"./index.31c70196.js";import{e as I}from"./index.5926f13f.js";import O from"./table-action.9671220e.js";import{a as K,r as _}from"./common.145f2eef.js";import{r as V}from"./use-table.1da87de1.js";import{D as W,C as r,c as A}from"./column-width-config.63466f21.js";import{a as B}from"./Dropdown.749e9383.js";import L from"./process-instance-condition.d81e955d.js";import{N as q,a as M}from"./DataTable.d85b2298.js";import{N as $}from"./Tooltip.d759bd4b.js";import{N as F}from"./Button.c43a24dc.js";import{N as G}from"./Popconfirm.83d41c5f.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./keysOf.963e6f6c.js";import"./service.0215c8a4.js";import"./FormOutlined.848330c3.js";import"./SyncOutlined.859a474f.js";import"./CloseCircleOutlined.46c86330.js";import"./PlayCircleOutlined.7616d1e9.js";import"./PauseCircleOutlined.813adbbb.js";import"./InfoCircleFilled.46393fdc.js";import"./DeleteOutlined.e68b06d7.js";import"./ControlOutlined.6fd04d4e.js";import"./Icon.8e3bf5ec.js";import"./format-length.e7c2072e.js";import"./Space.e50db48f.js";import"./is-browser.d3e5def6.js";import"./flatten.a7868693.js";import"./get-slot.c85d6606.js";import"./SettingOutlined.716a0298.js";import"./CheckCircleOutlined.6daee0ce.js";import"./EditOutlined.af3970b8.js";import"./ClockCircleOutlined.6c97131a.js";import"./index.a2051d72.js";import"./index.075b615e.js";import"./DownloadOutlined.8c21680b.js";import"./Spin.1e9405a1.js";import"./fade-in.cssr.9da325c6.js";import"./use-compitable.b0459e69.js";import"./Popover.df2981b4.js";import"./index.3e01cddc.js";import"./Scrollbar.12b40993.js";import"./VResizeObserver.14b04bb7.js";import"./utils.3eee947a.js";import"./next-frame-once.da993024.js";import"./ChevronRight.f70a9c2d.js";import"./Selection.a106a9c5.js";import"./use-locale.be539345.js";import"./Suffix.9ee1fead.js";import"./fade-in-scale-up.cssr.05526022.js";import"./use-keyboard.22724d1e.js";import"./SearchOutlined.5b629110.js";import"./Grid.b73d23e7.js";import"./Input.97d5419b.js";import"./Select.e833ee40.js";import"./DatePicker.fbb7ccb7.js";import"./Forward.23552619.js";import"./ArrowDown.db19052e.js";import"./Checkbox.7506e5f5.js";import"./RadioGroup.47f9a37a.js";import"./Radio.5a2a0c2a.js";const H="_content_103uo_17",X="_card_103uo_20",Y="_header_103uo_23",J="_right_103uo_29",Q="_search_103uo_29",Z="_list_103uo_29",ee="_table_103uo_34",te="_pagination_103uo_55",oe="_operation_103uo_62",ae="_startup_103uo_66";var m={content:H,card:X,header:Y,right:J,search:Q,list:Z,table:ee,pagination:te,operation:oe,startup:ae};function se(){const{t:o}=T(),s=S(),e=N({columns:[],tableWidth:W,checkedRowKeys:[],tableData:[],page:c(1),pageSize:c(10),totalPage:c(1),searchVal:c(),executorName:c(),host:c(),stateType:c(),startDate:c(),endDate:c(),projectCode:c(Number(s.currentRoute.value.params.projectCode)),loadingRef:c(!1)}),w=a=>{a.columns=[{type:"selection",className:"btn-selected",...r.selection},{title:"#",key:"id",...r.index,render:(t,i)=>i+1},{title:o("project.workflow.workflow_name"),key:"name",...r.linkName,className:"workflow-name",render:t=>y(x,{onClick:()=>void s.push({name:"workflow-instance-detail",params:{id:t.id},query:{code:t.processDefinitionCode}})},{default:()=>y(B,r.linkEllipsis,()=>t.name)})},{title:o("project.workflow.status"),key:"state",...r.state,className:"workflow-status",render:t=>V(t.state,o)},{title:o("project.workflow.run_type"),key:"commandType",width:160,className:"workflow-run-type",render:t=>(D.filter(K(o),i=>i.code===t.commandType)[0]||{}).desc},{title:o("project.workflow.scheduling_time"),key:"scheduleTime",...r.time,render:t=>_(t.scheduleTime)},{title:o("project.workflow.start_time"),key:"startTime",...r.time,render:t=>_(t.startTime)},{title:o("project.workflow.end_time"),key:"endTime",...r.time,render:t=>_(t.endTime)},{title:o("project.workflow.duration"),key:"duration",...r.duration,render:t=>t.duration||"-"},{title:o("project.workflow.run_times"),key:"runTimes",...r.times,className:"workflow-run-times"},{title:o("project.workflow.fault_tolerant_sign"),key:"recovery",width:100},{title:o("project.workflow.dry_run_flag"),key:"dryRun",...r.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:o("project.workflow.executor"),key:"executorName",...r.name},{title:o("project.workflow.host"),key:"host",...r.name},{title:o("project.workflow.operation"),key:"operation",...r.operation(6),className:m.operation,render:(t,i)=>y(O,{row:t,onReRun:()=>n({index:i,processInstanceId:t.id,executeType:"REPEAT_RUNNING",buttonType:"run"}),onReStore:()=>n({index:i,processInstanceId:t.id,executeType:"START_FAILURE_TASK_PROCESS",buttonType:"store"}),onStop:()=>{t.state==="STOP"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):h({processInstanceId:t.id,executeType:"STOP"})},onSuspend:()=>{t.state==="PAUSE"?n({index:i,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):h({processInstanceId:t.id,executeType:"PAUSE"})},onDeleteInstance:()=>d(t.id)})}],a.tableWidth&&(a.tableWidth=A(a.columns))},p=()=>{if(e.loadingRef)return;e.loadingRef=!0;const a={pageNo:e.page,pageSize:e.pageSize,searchVal:e.searchVal,executorName:e.executorName,host:e.host,stateType:e.stateType,startDate:e.startDate,endDate:e.endDate};v({...a},e.projectCode).then(t=>{e.totalPage=t.totalPage,e.tableData=t.totalList.map(i=>({...i})),e.loadingRef=!1})},d=a=>{z(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===1&&e.page>1&&(e.page-=1),p()})},g=()=>{const a={processInstanceIds:D.join(e.checkedRowKeys,",")};U(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],p()})},h=a=>{I(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),p()})},k=(a,t)=>{let f,u;f||(u=10,f=setInterval(()=>{u>0&&u<=10?(u--,e.tableData[t].count=u):(a(),clearInterval(f),f=void 0)},1e3))},n=a=>{const{index:t}=a;e.tableData[t].buttonType=a.buttonType,I(a,e.projectCode).then(()=>{e.tableData[t].disabled=!0,window.$message.success(o("project.workflow.success")),k(()=>{p()},t)})};return{variables:e,createColumns:w,getTableData:p,batchDeleteInstance:g}}var yt=R({name:"WorkflowInstanceList",setup(){let o;const{variables:s,createColumns:e,getTableData:w,batchDeleteInstance:p}=se(),d=()=>{w()},g=n=>{s.searchVal=n.searchVal,s.executorName=n.executorName,s.host=n.host,s.stateType=n.stateType,s.startDate=n.startDate,s.endDate=n.endDate,s.page=1,d()},h=()=>{s.page=1,d()},k=()=>{p()};return j(()=>{e(s),d(),o=setInterval(()=>{d()},9e3)}),C(T().locale,()=>{e(s)}),P(()=>{clearInterval(o)}),{requestData:d,handleSearch:g,handleChangePageSize:h,handleBatchDelete:k,...E(s)}},render(){const{t:o}=T(),{loadingRef:s}=this;return l("div",{class:m.content},[l(b,{class:m.card},{default:()=>[l("div",{class:m.header},[l(L,{onHandleSearch:this.handleSearch},null)])]}),l(b,{title:o("project.workflow.workflow_instance")},{default:()=>[l(q,{loading:s,rowKey:e=>e.id,columns:this.columns,data:this.tableData,striped:!0,size:"small",class:m.table,scrollX:this.tableWidth,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":e=>this.checkedRowKeys=e,"row-class-name":"items-workflow-instances"},null),l("div",{class:m.pagination},[l(M,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]),l($,null,{default:()=>o("project.workflow.delete"),trigger:()=>l(F,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,style:"position: absolute; bottom: 10px; left: 10px;",class:"btn-delete-all"},{default:()=>[l(G,{onPositiveClick:this.handleBatchDelete},{default:()=>o("project.workflow.delete_confirm"),trigger:()=>o("project.workflow.delete")})]})})]})])}});export{yt as default};
