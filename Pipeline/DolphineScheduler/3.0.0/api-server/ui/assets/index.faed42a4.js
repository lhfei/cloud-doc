import{C as z}from"./index.97f03277.js";import{UserModal as w}from"./user-detail-modal.21ca81da.js";import{AuthorizeModal as C}from"./authorize-modal.2dbdffc2.js";import{u as g,a as M,h as a,o as S,w as T,r as _,d as b,t as U,c as i,_ as R,a2 as v}from"./index.c5429249.js";import{C as l,c as I,D as L}from"./column-width-config.63466f21.js";import{N as O}from"./Dropdown.749e9383.js";import{U as j}from"./UserOutlined.b8e58dd2.js";import{E as D}from"./EditOutlined.af3970b8.js";import{D as P}from"./DeleteOutlined.e68b06d7.js";import{d as V}from"./Selection.a106a9c5.js";import{N as y}from"./Tooltip.d759bd4b.js";import{N as h}from"./Button.c43a24dc.js";import{N as f}from"./Icon.8e3bf5ec.js";import{N as A}from"./Popconfirm.83d41c5f.js";import{N as d}from"./Space.e50db48f.js";import{q as E,d as W}from"./index.f239614a.js";import{p as N}from"./common.145f2eef.js";import{f as k}from"./index.a2051d72.js";import{S as q}from"./SearchOutlined.5b629110.js";import{N as H}from"./Input.97d5419b.js";import{N as x,a as B}from"./DataTable.d85b2298.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./keysOf.963e6f6c.js";import"./lodash.084a01e7.js";import"./index.d81654bf.js";import"./service.0215c8a4.js";import"./index.1064dc71.js";import"./index.20e11ec3.js";import"./index.3b9f9e63.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./fade-in-scale-up.cssr.05526022.js";import"./utils.3eee947a.js";import"./is-browser.d3e5def6.js";import"./Form.13999875.js";import"./FormItem.51e71cc3.js";import"./format-length.e7c2072e.js";import"./Select.e833ee40.js";import"./use-locale.be539345.js";import"./use-compitable.b0459e69.js";import"./Popover.df2981b4.js";import"./next-frame-once.da993024.js";import"./RadioGroup.47f9a37a.js";import"./get-slot.c85d6606.js";import"./Radio.5a2a0c2a.js";import"./index.bbb6cfa3.js";import"./index.3b5bce66.js";import"./index.8259a597.js";import"./index.e24493be.js";import"./Checkbox.7506e5f5.js";import"./ChevronRight.f70a9c2d.js";import"./RadioButton.2ddd4a35.js";import"./TreeSelect.b9641da1.js";import"./use-keyboard.22724d1e.js";import"./Suffix.9ee1fead.js";import"./SettingOutlined.716a0298.js";import"./PauseCircleOutlined.813adbbb.js";import"./CloseCircleOutlined.46c86330.js";import"./CheckCircleOutlined.6daee0ce.js";import"./ClockCircleOutlined.6c97131a.js";import"./ArrowDown.db19052e.js";import"./Forward.23552619.js";function F(t){const{t:e}=g(),o=M({columns:[],tableWidth:L}),n=()=>{const c=[{title:"#",key:"index",render:(s,p)=>p+1,...l.index},{title:e("security.user.username"),key:"userName",className:"name",...l.userName},{title:e("security.user.user_type"),key:"userType",render:s=>s.userType==="GENERAL_USER"?e("security.user.ordinary_user"):e("security.user.administrator"),...l.type},{title:e("security.user.tenant_code"),key:"tenantCode",...l.name},{title:e("security.user.queue"),key:"queue",width:120},{title:e("security.user.email"),key:"email",...l.name},{title:e("security.user.phone"),key:"phone",width:140},{title:e("security.user.state"),key:"state",...l.state,render:(s,p)=>a(V,{type:s.state===1?"success":"error"},{default:()=>e(`security.user.state_${s.state===1?"enabled":"disabled"}`)})},{title:e("security.user.create_time"),key:"createTime",...l.time},{title:e("security.user.update_time"),key:"updateTime",...l.time},{title:e("security.user.operation"),key:"operation",...l.operation(3),render:(s,p)=>a(d,null,{default:()=>[a(O,{trigger:"click",options:[{label:e("security.user.project"),key:"authorize_project"},{label:e("security.user.resource"),key:"authorize_resource"},{label:e("security.user.datasource"),key:"authorize_datasource"},{label:e("security.user.udf"),key:"authorize_udf"},{label:e("security.user.namespace"),key:"authorize_namespace"}],onSelect:r=>void t({rowData:s,key:r},"authorize")},()=>a(y,{trigger:"hover"},{trigger:()=>a(h,{circle:!0,type:"warning",size:"small",class:"authorize"},{icon:()=>a(f,null,()=>a(j))}),default:()=>e("security.user.authorize")})),a(y,{trigger:"hover"},{trigger:()=>a(h,{circle:!0,type:"info",size:"small",class:"edit",onClick:()=>void t({rowData:s},"edit")},()=>a(f,null,()=>a(D))),default:()=>e("security.user.edit")}),a(A,{onPositiveClick:()=>void t({rowData:s},"delete")},{trigger:()=>a(y,{},{trigger:()=>a(h,{circle:!0,type:"error",size:"small",class:"delete"},{icon:()=>a(f,null,{default:()=>a(P)})}),default:()=>e("security.user.delete")}),default:()=>e("security.user.delete_confirm")})]})}];o.value={columns:c,tableWidth:I(c)}};return S(()=>{n()}),T(g().locale,()=>{n()}),{columnsRef:o,createColumns:n}}function G(){const t=_({page:1,pageSize:10,itemCount:0,searchVal:"",list:[],loading:!1,currentRecord:{},authorizeType:"authorize_project",detailModalShow:!1,authorizeModalShow:!1}),e=async()=>{if(t.loading)return;t.loading=!0;const{totalList:r,total:m}=await E({pageNo:t.page,pageSize:t.pageSize,searchVal:t.searchVal});if(t.loading=!1,!r)throw Error();t.list=r.map(u=>(u.createTime=u.createTime?k(N(u.createTime),"yyyy-MM-dd HH:mm:ss"):"",u.updateTime=u.updateTime?k(N(u.updateTime),"yyyy-MM-dd HH:mm:ss"):"",u.tenantId=u.tenantId===0?null:u.tenantId,u)),t.itemCount=m},o=()=>{t.list.length===1&&t.page>1&&--t.page,e()},n=async r=>{await W({id:r}),o()},c=(r,m)=>{t.currentRecord=r.rowData,m==="edit"&&(t.detailModalShow=!0),m==="authorize"&&r.key&&(t.authorizeModalShow=!0,t.authorizeType=r.key),m==="delete"&&n(r.rowData.id)},s=r=>{t.page=r,e()},p=r=>{t.page=1,t.pageSize=r,e()};return S(()=>{e()}),{state:t,changePage:s,changePageSize:p,updateList:o,onOperationClick:c}}function X(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!R(t)}const lt=b({name:"user-manage",setup(){const{t}=g(),{state:e,changePage:o,changePageSize:n,updateList:c,onOperationClick:s}=G(),{columnsRef:p}=F(s),r=()=>{e.detailModalShow=!0,e.currentRecord=null},m=()=>{e.detailModalShow=!1},u=()=>{e.authorizeModalShow=!1};return{t,columnsRef:p,...U(e),changePage:o,changePageSize:n,onAddUser:r,onUpdatedList:c,onDetailModalCancel:m,onAuthorizeModalCancel:u}},render(){var e;let t;return i(v,null,[i(d,{vertical:!0},{default:()=>[i(z,null,{default:()=>[i(d,{justify:"space-between"},{default:()=>[i(h,{onClick:this.onAddUser,type:"primary",class:"btn-create-user"},X(t=this.t("security.user.create_user"))?t:{default:()=>[t]}),i(d,null,{default:()=>[i(H,{value:this.searchVal,"onUpdate:value":o=>this.searchVal=o,clearable:!0},null),i(h,{type:"primary",onClick:this.onUpdatedList},{default:()=>[i(f,null,{default:()=>[i(q,null,null)]})]})]})]})]}),i(z,null,{default:()=>[i(d,{vertical:!0},{default:()=>[i(x,{"row-class-name":"items",columns:this.columnsRef.columns,data:this.list,loading:this.loading,scrollX:this.columnsRef.tableWidth},null),i(d,{justify:"center"},{default:()=>[i(B,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"item-count":this.itemCount,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,"on-update:page":this.changePage,"on-update:page-size":this.changePageSize},null)]})]})]})]}),i(w,{show:this.detailModalShow,currentRecord:this.currentRecord,onCancel:this.onDetailModalCancel,onUpdate:this.onUpdatedList},null),i(C,{show:this.authorizeModalShow,type:this.authorizeType,userId:(e=this.currentRecord)==null?void 0:e.id,onCancel:this.onAuthorizeModalCancel},null)])}});export{lt as default};
