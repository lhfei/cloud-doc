import{u as w,r as y,a as l,h as a,bl as N,d as D,w as g,t as C,c as d}from"./index.c5429249.js";import{u as b,a as z}from"./use-modal.4eacfaef.js";import{i as V,s as P,j as R}from"./index.cc06751b.js";import{E as S}from"./ExclamationCircleOutlined.e3fe8f60.js";import{D as M}from"./DeleteOutlined.e68b06d7.js";import{d as T}from"./Selection.a106a9c5.js";import{N as h}from"./Popconfirm.83d41c5f.js";import{N as k}from"./Tooltip.d759bd4b.js";import{N as v}from"./Button.c43a24dc.js";import{N as I}from"./Space.e50db48f.js";import{M as $}from"./index.20e11ec3.js";import{s as j}from"./index.module.e21b9b67.js";import{N as q,a as L}from"./DataTable.d85b2298.js";import"./lodash.084a01e7.js";import"./index.fd50cc71.js";import"./service.0215c8a4.js";import"./index.8ea7b56a.js";import"./index.c537589f.js";import"./index.5926f13f.js";import"./common.145f2eef.js";import"./SettingOutlined.716a0298.js";import"./PauseCircleOutlined.813adbbb.js";import"./CloseCircleOutlined.46c86330.js";import"./CheckCircleOutlined.6daee0ce.js";import"./EditOutlined.af3970b8.js";import"./ClockCircleOutlined.6c97131a.js";import"./index.a2051d72.js";import"./VResizeObserver.14b04bb7.js";import"./Popover.df2981b4.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./format-length.e7c2072e.js";import"./utils.3eee947a.js";import"./resolve-slot.7c241306.js";import"./use-compitable.b0459e69.js";import"./next-frame-once.da993024.js";import"./index.16077d24.js";import"./use-locale.be539345.js";import"./use-rtl.c78ffbd8.js";import"./Suffix.9ee1fead.js";import"./keysOf.963e6f6c.js";import"./is-browser.d3e5def6.js";import"./get-slot.c85d6606.js";import"./index.3b9f9e63.js";import"./Card.c707a1eb.js";import"./fade-in-scale-up.cssr.05526022.js";import"./ArrowDown.db19052e.js";import"./Checkbox.7506e5f5.js";import"./RadioGroup.47f9a37a.js";import"./Radio.5a2a0c2a.js";import"./Dropdown.749e9383.js";import"./Icon.8e3bf5ec.js";import"./ChevronRight.f70a9c2d.js";import"./use-keyboard.22724d1e.js";import"./Input.97d5419b.js";import"./Select.e833ee40.js";import"./Forward.23552619.js";function _(i){const{t:o}=w(),s=N(),e=y({columns:[],row:{},tableData:[],page:l(1),totalPage:l(1),pageSize:l(10),projectCode:l(Number(s.currentRoute.value.params.projectCode)),loadingRef:l(!1)}),u=(t,m)=>{t.columns=[{title:"#",key:"id",width:50,render:(r,n)=>n+1},{title:o("project.workflow.version"),key:"version",render:r=>r.version===t.row.version?a(T,{type:"success",size:"small"},{default:()=>`V${r.version} ${o("project.workflow.current_version")}`}):`V${r.version}`},{title:o("project.workflow.description"),key:"description"},{title:o("project.workflow.create_time"),key:"operateTime"}],m||t.columns.push({title:o("project.workflow.operation"),key:"operation",render:r=>a(I,null,{default:()=>[a(h,{onPositiveClick:()=>{f(r.version)}},{trigger:()=>a(k,{},{trigger:()=>a(v,{circle:!0,type:"info",size:"tiny",disabled:r.version===t.row.version},{icon:()=>a(S)}),default:()=>o("project.workflow.switch_version")}),default:()=>o("project.workflow.confirm_switch_version")}),a(h,{onPositiveClick:()=>{c(r.version)}},{trigger:()=>a(k,{},{trigger:()=>a(v,{circle:!0,type:"error",size:"tiny",disabled:r.version===t.row.version},{icon:()=>a(M)}),default:()=>o("project.workflow.delete")}),default:()=>o("project.workflow.delete_confirm")})]})})},p=t=>{e.loadingRef||(e.loadingRef=!0,e.row=t,V({pageSize:e.pageSize,pageNo:e.page},e.projectCode,e.row.code).then(m=>{e.tableData=m.totalList.map(r=>({...r})),e.totalPage=m.totalPage,e.loadingRef=!1}))},f=t=>{P(e.projectCode,e.row.code,t).then(()=>{e.row.version=t,window.$message.success(o("project.workflow.success")),i.emit("updateList")})},c=t=>{R(e.projectCode,e.row.code,t).then(()=>{window.$message.success(o("project.workflow.success")),i.emit("updateList"),e.tableData.length===1&&e.page>1&&(e.page-=1),p(e.row)})};return{variables:e,createColumns:u,getTableData:p}}const B={isInstance:{type:Boolean,default:!1},show:{type:Boolean,default:!1},row:{type:Object,default:{}}};var Ge=D({name:"workflowDefinitionVersion",props:B,emits:["update:show","update:row","updateList"],setup(i,o){const{variables:s,createColumns:e,getTableData:u}=_(o),{importState:p}=b(),{handleImportDefinition:f}=z(p,o),c=()=>{var n;i.show&&((n=i.row)==null?void 0:n.code)&&u(i.row)},t=()=>{o.emit("update:show")},m=()=>{f()},r=({file:n})=>{p.importForm.name=n.name,p.importForm.file=n.file};return g(()=>i.show,()=>{e(s,i.isInstance),c()}),g(w().locale,()=>{e(s,i.isInstance)}),{hideModal:t,handleImport:m,customRequest:r,requestData:c,...C(s)}},render(){const{t:i}=w(),{requestData:o,loadingRef:s}=this;return d($,{show:this.$props.show,title:i("project.workflow.version_info"),onCancel:this.hideModal,onConfirm:this.hideModal},{default:()=>[d(q,{loading:s,columns:this.columns,data:this.tableData,striped:!0,size:"small",class:j.table},null),d("div",{class:j.pagination},[d(L,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,onUpdatePage:o},null)])]})}});export{Ge as default};
