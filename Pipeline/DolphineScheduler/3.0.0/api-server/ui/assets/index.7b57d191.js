import{u as P,h as y,bl as x,d as H,a as g,r as L,o as w,c as e,_ as X}from"./index.c5429249.js";import{C as U}from"./index.97f03277.js";import{b as J}from"./common.145f2eef.js";import{u as D}from"./file.0dabb2be.js";import K from"./table-action.60b2d775.js";import{B as Q}from"./index.3b9f9e63.js";import{c as Y,D as Z,C as f}from"./column-width-config.63466f21.js";import{a as ee}from"./Dropdown.749e9383.js";import{u as I}from"./index.075b615e.js";import{q as te,v as oe,a as F,b as ie}from"./index.8259a597.js";import ae from"./index.5173287e.js";import re from"./index.9b71a5c2.js";import se from"./index.b656bf45.js";import{s as h}from"./index.module.9dd9e39b.js";import{N as le}from"./ButtonGroup.437137c8.js";import{S as ne}from"./SearchOutlined.5b629110.js";import{N as ue,a as B}from"./BreadcrumbItem.10fc7694.js";import{N as pe}from"./Space.e50db48f.js";import{N as b}from"./Button.c43a24dc.js";import{N as me}from"./Icon.8e3bf5ec.js";import{N as de}from"./Input.97d5419b.js";import{N as ce,a as fe}from"./DataTable.d85b2298.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./keysOf.963e6f6c.js";import"./lodash.084a01e7.js";import"./SettingOutlined.716a0298.js";import"./PauseCircleOutlined.813adbbb.js";import"./CloseCircleOutlined.46c86330.js";import"./CheckCircleOutlined.6daee0ce.js";import"./EditOutlined.af3970b8.js";import"./ClockCircleOutlined.6c97131a.js";import"./index.a2051d72.js";import"./FormOutlined.848330c3.js";import"./DownloadOutlined.8c21680b.js";import"./InfoCircleFilled.46393fdc.js";import"./DeleteOutlined.e68b06d7.js";import"./Tooltip.d759bd4b.js";import"./Popover.df2981b4.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./format-length.e7c2072e.js";import"./utils.3eee947a.js";import"./use-compitable.b0459e69.js";import"./next-frame-once.da993024.js";import"./Popconfirm.83d41c5f.js";import"./use-locale.be539345.js";import"./ChevronRight.f70a9c2d.js";import"./Selection.a106a9c5.js";import"./Suffix.9ee1fead.js";import"./fade-in-scale-up.cssr.05526022.js";import"./use-keyboard.22724d1e.js";import"./service.0215c8a4.js";import"./index.20e11ec3.js";import"./is-browser.d3e5def6.js";import"./trim.f84c3e44.js";import"./Form.13999875.js";import"./FormItem.51e71cc3.js";import"./Upload.6ed710a6.js";import"./Add.e846b00c.js";import"./Image.f79a9674.js";import"./get-slot.c85d6606.js";import"./ArrowDown.db19052e.js";import"./Checkbox.7506e5f5.js";import"./RadioGroup.47f9a37a.js";import"./Radio.5a2a0c2a.js";import"./Select.e833ee40.js";import"./Forward.23552619.js";const he=(r,i)=>{const t=D();t.setFileInfo(`${i.alias}|${i.size}`),i.directory?(t.setCurrentDir(`${i.fullName}`),r.push({name:"resource-file-subdirectory",params:{id:i.id}})):r.push({name:"resource-file-list",params:{id:i.id}})};function ge(r,i){const{t}=P(),u=x(),d=[{title:"#",key:"id",...f.index,render:(s,p)=>p+1},{title:t("resource.file.name"),key:"name",...f.linkName,render:s=>y(Q,{onClick:()=>void he(u,s)},{default:()=>y(ee,f.linkEllipsis,()=>s.name)})},{title:t("resource.file.user_name"),...f.userName,key:"user_name"},{title:t("resource.file.whether_directory"),key:"whether_directory",...f.yesOrNo,render:s=>s.directory?t("resource.file.yes"):t("resource.file.no")},{title:t("resource.file.file_name"),...f.name,key:"file_name"},{title:t("resource.file.description"),...f.note,key:"description"},{title:t("resource.file.size"),key:"size",...f.size,render:s=>J(s.size)},{title:t("resource.file.update_time"),...f.time,key:"update_time"},{title:t("resource.file.operation"),key:"operation",render:s=>y(K,{row:s,onRenameResource:(p,c,n)=>r(p,c,n),onUpdateList:()=>i()}),...f.operation(4)}];return{columnsRef:d,tableWidth:Y(d)||Z}}function Ne(r={}){return{getResourceListState:(u=-1,d="",s=1,p=10)=>{const{state:c}=I(te({id:u,type:"FILE",searchVal:d,pageNo:s,pageSize:p}).then(n=>{const{total:N}=n;r(N);const l=n.totalList.map(o=>({id:o.id,name:o.alias,alias:o.alias,fullName:o.fullName,type:o.type,user_name:o.userName,directory:o.directory,file_name:o.fileName,description:o.description,size:o.size,update_time:o.updateTime}));return{total:N,table:l}}),{total:0,table:[]});return c},getResourceView:u=>{const d={skipLineNum:0,limit:3e3},{state:s}=I(oe(d,u),{});return s}}}function _(r){return typeof r=="function"||Object.prototype.toString.call(r)==="[object Object]"&&!X(r)}var Ot=H({name:"File",setup(){const r=x(),i=g(Number(r.currentRoute.value.params.id)||-1),t=g(),u=g(!1),d=g(!1),s=g(!1),p=g(),c=L({id:-1,name:"",description:""}),n=L({page:1,pageSize:10,itemCount:0,pageSizes:[10,30,50]}),N=a=>{n.page=a,t.value=R(i.value,p.value,n.page,n.pageSize)},l=a=>{n.page=1,n.pageSize=a,t.value=R(i.value,p.value,n.page,n.pageSize)},o=a=>{a.value=!0},T=a=>{n.itemCount=a},{getResourceListState:R}=Ne(T),M=()=>{t.value=R(i.value,p.value)},O=()=>{o(u)},j=()=>{const a=i.value?"resource-subfile-create":"resource-file-create";r.push({name:a,params:{id:i.value}})},q=()=>{o(d)},W=(a,m,S)=>{c.id=a,c.name=m,c.description=S,o(s)},E=()=>{r.push({name:"file-manage"})},G=()=>{t.value=R(i.value,p.value)},C=D();w(()=>{t.value=R(i.value)});const v=g([{id:1,fullName:"l1"},{id:2,fullName:"l2"},{id:4,fullName:"l3"}]);w(()=>{const a=Number(r.currentRoute.value.params.id)||-1;a===-1?C.setCurrentDir("/"):F(a).then(m=>{m.fullName&&C.setCurrentDir(m.fullName)})});const V=async a=>{var S,z;let m=0;for(const $ of a){const k=a.slice(0,m+1).join("/");if(k){const A=await ie({id:0,type:"FILE",fullName:k},0);(S=v.value)==null||S.push({id:A.id,fullName:$})}else(z=v.value)==null||z.push({id:0,fullName:"Root"});m=m+1}};return w(()=>{v.value=[],i.value!=-1&&F(i.value).then(a=>{if(a.fullName){const m=a.fullName.split("/");m&&m.length>1&&V(m)}})}),{fileId:i,searchRef:p,folderShowRef:u,uploadShowRef:d,renameShowRef:s,handleShowModal:o,resourceListRef:t,updateList:G,handleConditions:M,handleCreateFolder:O,handleCreateFile:j,handleUploadFile:q,handleRenameFile:W,handleUpdatePage:N,handleUpdatePageSize:l,handleGoRoot:E,pagination:n,renameInfo:c,breadcrumbItemsRef:v}},render(){let r,i,t;const{t:u}=P(),{columnsRef:d,tableWidth:s}=ge(this.handleRenameFile,this.updateList),{handleConditions:p,handleCreateFolder:c,handleCreateFile:n,handleUploadFile:N}=this;return e("div",null,[e(U,{style:{marginBottom:"8px"}},{default:()=>[e("div",{class:h["conditions-model"]},[e(pe,null,{default:()=>[e(le,null,{default:()=>[e(b,{onClick:c,class:"btn-create-directory"},_(r=u("resource.file.create_folder"))?r:{default:()=>[r]}),e(b,{onClick:n,class:"btn-create-file"},_(i=u("resource.file.create_file"))?i:{default:()=>[i]}),e(b,{onClick:N,class:"btn-upload-file"},_(t=u("resource.file.upload_files"))?t:{default:()=>[t]})]})]}),e("div",{class:h.right},[e("div",{class:h["form-box"]},[e("div",{class:h.list},[e(b,{onClick:p},{default:()=>[e(me,null,{default:()=>[e(ne,null,null)]})]})]),e("div",{class:h.list},[e(de,{placeholder:u("resource.file.enter_keyword_tips"),value:this.searchRef,"onUpdate:value":l=>this.searchRef=l},null)])])])])]}),e(U,{title:u("resource.file.file_manage"),class:h["table-card"]},{"header-extra":()=>e(ue,{separator:">",class:h.breadcrumb},{default:()=>{var l;return[(l=this.breadcrumbItemsRef)==null?void 0:l.map(o=>o.id===0?e(B,null,{default:()=>[e("span",{onClick:this.handleGoRoot},[o.fullName])]}):e(B,{href:o.id.toString()},{default:()=>[o.fullName]}))]}}),default:()=>{var l;return e("div",null,[e(ce,{remote:!0,columns:d,data:(l=this.resourceListRef)==null?void 0:l.value.table,striped:!0,size:"small",class:h["table-box"],"row-class-name":"items",scrollX:s},null),e("div",{class:h.pagination},[e(fe,{page:this.pagination.page,"onUpdate:page":o=>this.pagination.page=o,pageSize:this.pagination.pageSize,"onUpdate:pageSize":o=>this.pagination.pageSize=o,pageSizes:this.pagination.pageSizes,"item-count":this.pagination.itemCount,onUpdatePage:this.handleUpdatePage,onUpdatePageSize:this.handleUpdatePageSize,"show-quick-jumper":!0,"show-size-picker":!0},null)])])}}),e(ae,{show:this.folderShowRef,"onUpdate:show":l=>this.folderShowRef=l,onUpdateList:this.updateList},null),e(re,{show:this.uploadShowRef,"onUpdate:show":l=>this.uploadShowRef=l,onUpdateList:this.updateList},null),e(se,{show:this.renameShowRef,"onUpdate:show":l=>this.renameShowRef=l,id:this.renameInfo.id,name:this.renameInfo.name,description:this.renameInfo.description,onUpdateList:this.updateList},null)])}});export{Ot as default};
