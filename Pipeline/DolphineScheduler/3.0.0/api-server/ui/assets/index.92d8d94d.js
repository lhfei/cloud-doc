import{u as c,ah as a,r as h,a as p,br as f,w as F,d as g,o as v,t as I,c as t,_ as w}from"./index.c5429249.js";import{g as U,u as N}from"./index.f239614a.js";import{C as _}from"./index.97f03277.js";import{M as b}from"./index.20e11ec3.js";import C from"./info.19297cfe.js";import{N as R}from"./Button.c43a24dc.js";import{N as y}from"./Form.13999875.js";import{N as l}from"./FormItem.51e71cc3.js";import{N as n}from"./Input.97d5419b.js";import"./service.0215c8a4.js";import"./lodash.084a01e7.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./keysOf.963e6f6c.js";import"./index.3b9f9e63.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./fade-in-scale-up.cssr.05526022.js";import"./utils.3eee947a.js";import"./is-browser.d3e5def6.js";import"./Space.e50db48f.js";import"./get-slot.c85d6606.js";import"./format-length.e7c2072e.js";import"./use-locale.be539345.js";import"./Suffix.9ee1fead.js";function M(){const{t:e,locale:i}=c(),r=a().userInfo,o=h({profileFormRef:p(),profileForm:{username:r.userName,email:r.email,phone:r.phone},saving:!1,rules:{username:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.username==="")return new Error(e("profile.username_tips"))}},email:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.email==="")return new Error(e("profile.email_tips"));if(!f.regex.email.test(o.profileForm.email||""))return new Error(e("profile.email_correct_tips"))}}}});return F(r,()=>{o.profileForm={username:r.userName,email:r.email,phone:r.phone}}),{state:o,t:e,locale:i}}function S(){const e=a();return{getUserInfo:async()=>{const r=await U();await e.setUserInfo(r)}}}function q(e){const r=a().userInfo;return{handleUpdate:async()=>{if(await e.profileFormRef.validate(),e.saving!==!0){e.saving=!0;try{await N({userPassword:"",id:r.id,userName:e.profileForm.username,tenantId:r.tenantId,email:e.profileForm.email,phone:e.profileForm.phone,state:r.state,queue:r.queue}),e.saving=!1}catch{e.saving=!1}}}}}function x(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!w(e)}const se=g({name:"profile",setup(){const e=a().userInfo,i=p(!1),{state:r,t:o}=M(),{handleUpdate:s}=q(r),{getUserInfo:m}=S();v(async()=>{await m()});const u=()=>{i.value=!1,r.profileForm.email=e.email,r.profileForm.phone=e.phone,r.profileForm.username=e.userName},d=async()=>{i.value=!1,await s(),await m()};return{...I(r),showModalRef:i,t:o,onCancel:u,onConfirm:d}},render(){const{t:e,onCancel:i,onConfirm:r}=this;return t("div",null,[t(_,{title:e("profile.profile")},{default:()=>t(C,null,null),"header-extra":()=>{let o;return t(R,{type:"info",size:"small",onClick:()=>this.showModalRef=!this.showModalRef},x(o=e("profile.edit"))?o:{default:()=>[o]})}}),t(b,{title:e("profile.edit_profile"),show:this.showModalRef,onCancel:i,onConfirm:r,confirmDisabled:!this.profileForm.username||!this.profileForm.email||!f.regex.email.test(this.profileForm.email),confirmLoading:this.saving},{default:()=>t(y,{rules:this.rules,ref:"profileFormRef"},{default:()=>[t(l,{label:e("profile.username"),path:"username"},{default:()=>[t(n,{value:this.profileForm.username,"onUpdate:value":o=>this.profileForm.username=o,placeholder:e("profile.username_tips")},null)]}),t(l,{label:e("profile.email"),path:"email"},{default:()=>[t(n,{value:this.profileForm.email,"onUpdate:value":o=>this.profileForm.email=o,placeholder:e("profile.email_tips")},null)]}),t(l,{label:e("profile.phone"),path:"phone"},{default:()=>[t(n,{value:this.profileForm.phone,"onUpdate:value":o=>this.profileForm.phone=o,placeholder:e("profile.phone_tips")},null)]})]})})])}});export{se as default};
