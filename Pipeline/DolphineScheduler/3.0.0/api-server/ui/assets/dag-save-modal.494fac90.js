import{M as le}from"./index.20e11ec3.js";import{d as L,h as o,bD as re,aE as oe,az as ie,au as ue,ci as se,k as ce,n as M,q as j,p as W,x as de,v as pe,z as me,a as F,B as O,A as Z,j as U,C as fe,D as ve,N as D,cj as T,ck as E,ac as he,u as ge,o as H,cl as ye,w as be,c as p,bH as Pe,_ as Ie}from"./index.c5429249.js";import{a as we}from"./index.d81654bf.js";import{v as Re}from"./index.cc06751b.js";/* empty css                 */import{N,f as Ve}from"./Button.c43a24dc.js";import{N as _}from"./Input.97d5419b.js";import{u as ke}from"./use-rtl.c78ffbd8.js";import{u as je}from"./Scrollbar.12b40993.js";import{u as Ce}from"./use-locale.be539345.js";import{r as G,b as Se,c as $}from"./resolve-slot.7c241306.js";import{A as Y}from"./Add.e846b00c.js";import{N as Ae}from"./ButtonGroup.437137c8.js";import{R as De,N as Ne}from"./InputNumber.d8a1dfa4.js";import{A as Ue}from"./ArrowDown.db19052e.js";import{N as _e}from"./Form.13999875.js";import{N as I}from"./FormItem.51e71cc3.js";import{a as J}from"./Select.e833ee40.js";import{N as Le}from"./Switch.9ad161ba.js";import{a as Q}from"./Checkbox.7506e5f5.js";import"./index.3b9f9e63.js";import"./keysOf.963e6f6c.js";import"./Card.c707a1eb.js";import"./index.16077d24.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./fade-in.cssr.9da325c6.js";import"./fade-in-scale-up.cssr.05526022.js";import"./utils.3eee947a.js";import"./is-browser.d3e5def6.js";import"./Space.e50db48f.js";import"./get-slot.c85d6606.js";import"./service.0215c8a4.js";import"./lodash.084a01e7.js";import"./VResizeObserver.14b04bb7.js";import"./Suffix.9ee1fead.js";import"./format-length.e7c2072e.js";import"./use-compitable.b0459e69.js";import"./Selection.a106a9c5.js";import"./Popover.df2981b4.js";import"./next-frame-once.da993024.js";var Oe=L({name:"ArrowUp",render(){return o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},o("g",{fill:"none"},o("path",{d:"M3.13 9.163a.5.5 0 1 0 .74.674L9.5 3.67V17.5a.5.5 0 0 0 1 0V3.672l5.63 6.165a.5.5 0 0 0 .738-.674l-6.315-6.916a.746.746 0 0 0-.632-.24a.746.746 0 0 0-.476.24L3.131 9.163z",fill:"currentColor"})))}});const Be=()=>se,Fe=re({name:"DynamicInput",common:oe,peers:{Input:ie,Button:ue},self:Be});var Te=Fe;const z=ce("n-dynamic-input");var Ee=L({name:"DynamicInputInputPreset",props:{clsPrefix:{type:String,required:!0},value:{type:String,default:""},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(){const{mergedThemeRef:e,placeholderRef:h}=M(z);return{mergedTheme:e,placeholder:h}},render(){const{mergedTheme:e,placeholder:h,value:s,clsPrefix:l,onUpdateValue:g}=this;return o("div",{class:`${l}-dynamic-input-preset-input`},o(_,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:s,placeholder:h,onUpdateValue:g}))}}),$e=L({name:"DynamicInputPairPreset",props:{clsPrefix:{type:String,required:!0},value:{type:Object,default:()=>({key:"",value:""})},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(e){const{mergedThemeRef:h,keyPlaceholderRef:s,valuePlaceholderRef:l}=M(z);return{mergedTheme:h,keyPlaceholder:s,valuePlaceholder:l,handleKeyInput(g){e.onUpdateValue({key:g,value:e.value.value})},handleValueInput(g){e.onUpdateValue({key:e.value.key,value:g})}}},render(){const{mergedTheme:e,keyPlaceholder:h,valuePlaceholder:s,value:l,clsPrefix:g}=this;return o("div",{class:`${g}-dynamic-input-preset-pair`},o(_,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.key,class:`${g}-dynamic-input-pair-input`,placeholder:h,onUpdateValue:this.handleKeyInput}),o(_,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.value,class:`${g}-dynamic-input-pair-input`,placeholder:s,onUpdateValue:this.handleValueInput}))}}),Me=j("dynamic-input",{width:"100%"},[j("dynamic-input-item",`
 margin-bottom: 10px;
 display: flex;
 flex-wrap: nowrap;
 `,[j("dynamic-input-preset-input",{flex:1,alignItems:"center"}),j("dynamic-input-preset-pair",`
 flex: 1;
 display: flex;
 align-items: center;
 `,[j("dynamic-input-pair-input",[W("&:first-child",{"margin-right":"12px"})])]),de("action",`
 align-self: flex-start;
 display: flex;
 justify-content: flex-end;
 flex-shrink: 0;
 flex-grow: 0;
 margin: var(--action-margin);
 `,[pe("icon",{cursor:"pointer"})]),W("&:last-child",{marginBottom:0})]),j("form-item",`
 padding-top: 0 !important;
 margin-right: 0 !important;
 `,[j("form-item-blank",{paddingTop:"0 !important"})])]);const B=new WeakMap,ze=Object.assign(Object.assign({},Z.props),{max:Number,min:{type:Number,default:0},value:Array,defaultValue:{type:Array,default:()=>[]},preset:{type:String,default:"input"},keyField:String,itemStyle:[String,Object],keyPlaceholder:{type:String,default:""},valuePlaceholder:{type:String,default:""},placeholder:{type:String,default:""},showSortButton:Boolean,createButtonProps:Object,onCreate:Function,onRemove:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onClear:Function,onInput:[Function,Array]});var xe=L({name:"DynamicInput",props:ze,setup(e,{slots:h}){const{mergedComponentPropsRef:s,mergedClsPrefixRef:l,mergedRtlRef:g,inlineThemeDisabled:v}=me(),w=M(Ve,null),a=F(e.defaultValue),V=O(e,"value"),y=je(V,a),f=Z("DynamicInput","-dynamic-input",Me,Te,e,l),C=U(()=>{const{value:t}=y;if(Array.isArray(t)){const{max:n}=e;return n!==void 0&&t.length>=n}return!1}),k=U(()=>{const{value:t}=y;return Array.isArray(t)?t.length<=e.min:!0}),r=U(()=>{var t,n;return(n=(t=s==null?void 0:s.value)===null||t===void 0?void 0:t.DynamicInput)===null||n===void 0?void 0:n.buttonSize});function d(t){const{onInput:n,"onUpdate:value":c,onUpdateValue:u}=e;n&&$(n,t),c&&$(c,t),u&&$(u,t),a.value=t}function i(t,n){if(t==null||typeof t!="object")return n;const c=T(t)?E(t):t;let u=B.get(c);return u===void 0&&B.set(c,u=he()),u}function b(t,n){const{value:c}=y,u=Array.from(c!=null?c:[]),R=u[t];if(u[t]=n,R&&n&&typeof R=="object"&&typeof n=="object"){const ae=T(R)?E(R):R,ne=T(n)?E(n):n,q=B.get(ae);q!==void 0&&B.set(ne,q)}d(u)}function P(){m(0)}function m(t){const{value:n}=y,{onCreate:c}=e,u=Array.from(n!=null?n:[]);if(c)u.splice(t+1,0,c(t+1)),d(u);else if(h.default)u.splice(t+1,0,null),d(u);else switch(e.preset){case"input":u.splice(t+1,0,""),d(u);break;case"pair":u.splice(t+1,0,{key:"",value:""}),d(u);break}}function A(t){const{value:n}=y;if(!Array.isArray(n))return;const{min:c}=e;if(n.length<=c)return;const u=Array.from(n);u.splice(t,1),d(u);const{onRemove:R}=e;R&&R(t)}function x(t,n,c){if(n<0||c<0||n>=t.length||c>=t.length||n===c)return;const u=t[n];t[n]=t[c],t[c]=u}function ee(t,n){const{value:c}=y;if(!Array.isArray(c))return;const u=Array.from(c);t==="up"&&x(u,n,n-1),t==="down"&&x(u,n,n+1),d(u)}fe(z,{mergedThemeRef:f,keyPlaceholderRef:O(e,"keyPlaceholder"),valuePlaceholderRef:O(e,"valuePlaceholder"),placeholderRef:O(e,"placeholder")});const te=ke("DynamicInput",g,l),K=U(()=>{const{self:{actionMargin:t,actionMarginRtl:n}}=f.value;return{"--action-margin":t,"--action-margin-rtl":n}}),S=v?ve("dynamic-input",void 0,K,e):void 0;return{locale:Ce("DynamicInput").localeRef,rtlEnabled:te,buttonSize:r,mergedClsPrefix:l,NFormItem:w,uncontrolledValue:a,mergedValue:y,insertionDisabled:C,removeDisabled:k,handleCreateClick:P,ensureKey:i,handleValueChange:b,remove:A,move:ee,createItem:m,mergedTheme:f,cssVars:v?void 0:K,themeClass:S==null?void 0:S.themeClass,onRender:S==null?void 0:S.onRender}},render(){const{$slots:e,buttonSize:h,mergedClsPrefix:s,mergedValue:l,locale:g,mergedTheme:v,keyField:w,itemStyle:a,preset:V,showSortButton:y,NFormItem:f,ensureKey:C,handleValueChange:k,remove:r,createItem:d,move:i,onRender:b}=this;return b==null||b(),o("div",{class:[`${s}-dynamic-input`,this.rtlEnabled&&`${s}-dynamic-input--rtl`,this.themeClass],style:this.cssVars},!Array.isArray(l)||l.length===0?o(N,Object.assign({block:!0,ghost:!0,dashed:!0,size:h},this.createButtonProps,{disabled:this.insertionDisabled,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:this.handleCreateClick}),{default:()=>G(e["create-button-default"],()=>[g.create]),icon:()=>G(e["create-button-icon"],()=>[o(D,{clsPrefix:s},{default:()=>o(Y,null)})])}):l.map((P,m)=>o("div",{key:w?P[w]:C(P,m),"data-key":w?P[w]:C(P,m),class:`${s}-dynamic-input-item`,style:a},Se(e.default,{value:l[m],index:m},()=>[V==="input"?o(Ee,{clsPrefix:s,value:l[m],parentPath:f?f.path.value:void 0,path:f!=null&&f.path.value?`${f.path.value}[${m}]`:void 0,onUpdateValue:A=>k(m,A)}):V==="pair"?o($e,{clsPrefix:s,value:l[m],parentPath:f?f.path.value:void 0,path:f!=null&&f.path.value?`${f.path.value}[${m}]`:void 0,onUpdateValue:A=>k(m,A)}):null]),o("div",{class:`${s}-dynamic-input-item__action`},o(Ae,{size:h},{default:()=>[o(N,{disabled:this.removeDisabled,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,circle:!0,onClick:()=>r(m)},{icon:()=>o(D,{clsPrefix:s},{default:()=>o(De,null)})}),o(N,{disabled:this.insertionDisabled,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>d(m)},{icon:()=>o(D,{clsPrefix:s},{default:()=>o(Y,null)})}),y?o(N,{disabled:m===0,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>i("up",m)},{icon:()=>o(D,{clsPrefix:s},{default:()=>o(Oe,null)})}):null,y?o(N,{disabled:m===l.length-1,circle:!0,theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,onClick:()=>i("down",m)},{icon:()=>o(D,{clsPrefix:s},{default:()=>o(Ue,null)})}):null]})))))}});function X(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Ie(e)}const Ke={visible:{type:Boolean,default:!1},definition:{type:Object,default:void 0},instance:{type:Object,default:void 0}};var Ut=L({name:"dag-save-modal",props:Ke,emits:["update:show","save"],setup(e,h){const s=Pe(),{t:l}=ge(),g=Number(s.params.projectCode),v=F([]),w=U(()=>v.value?v.value.map(r=>({label:r.tenantCode,value:r.tenantCode})).concat({label:"default",value:"default"}):[]);H(()=>{we().then(r=>{v.value=r})});const a=F({name:"",description:"",tenantCode:"default",executionType:"PARALLEL",timeoutFlag:!1,timeout:0,globalParams:[],release:!1,sync:!1}),V=F(),y={name:{required:!0,message:l("project.dag.dag_name_empty")},timeout:{validator(){if(a.value.timeoutFlag&&!ye.test(String(a.value.timeout)))return new Error(l("project.dag.positive_integer"))}},globalParams:{validator(){const r=new Set,d=a.value.globalParams.map(b=>b.key);if(new Set(d).size!==d.length)return new Error(l("project.dag.prop_repeat"));for(const b of a.value.globalParams){const P=b.value;if(!P)return new Error(l("project.dag.prop_empty"));r.add(P)}}}},f=()=>{V.value.validate(async r=>{var d;if(!r){const i={name:a.value.name};((d=e.definition)==null?void 0:d.processDefinition.name)!==a.value.name?Re(i,g).then(()=>h.emit("save",a.value)):h.emit("save",a.value)}})},C=()=>{h.emit("update:show",!1)},k=()=>{var d;const r=(d=e.definition)==null?void 0:d.processDefinition;r&&(a.value.name=r.name,a.value.description=r.description,a.value.tenantCode=r.tenantCode||"default",a.value.executionType=r.executionType||"PARALLEL",r.timeout&&r.timeout>0&&(a.value.timeoutFlag=!0,a.value.timeout=r.timeout),a.value.globalParams=r.globalParamList.map(i=>({key:i.prop,value:i.value})))};return H(()=>k()),be(()=>{var r;return(r=e.definition)==null?void 0:r.processDefinition},()=>k()),()=>{let r,d;return p(le,{show:e.visible,title:l("project.dag.basic_info"),onConfirm:f,onCancel:C,autoFocus:!1},{default:()=>[p(_e,{model:a.value,rules:y,ref:V},{default:()=>[p(I,{label:l("project.dag.workflow_name"),path:"name"},{default:()=>[p(_,{value:a.value.name,"onUpdate:value":i=>a.value.name=i,class:"input-name"},null)]}),p(I,{label:l("project.dag.description"),path:"description"},{default:()=>[p(_,{type:"textarea",value:a.value.description,"onUpdate:value":i=>a.value.description=i,class:"input-description"},null)]}),p(I,{label:l("project.dag.tenant"),path:"tenantCode"},{default:()=>[p(J,{options:w.value,value:a.value.tenantCode,"onUpdate:value":i=>a.value.tenantCode=i,class:"btn-select-tenant-code"},null)]}),p(I,{label:l("project.dag.timeout_alert"),path:"timeoutFlag"},{default:()=>[p(Le,{value:a.value.timeoutFlag,"onUpdate:value":i=>a.value.timeoutFlag=i},null)]}),a.value.timeoutFlag&&p(I,{showLabel:!1,path:"timeout"},{default:()=>[p(Ne,{value:a.value.timeout,"onUpdate:value":i=>a.value.timeout=i,"show-button":!1,min:0},{suffix:()=>l("project.dag.minute")})]}),!e.instance&&p(I,{label:l("project.dag.process_execute_type"),path:"executionType"},{default:()=>[p(J,{options:[{value:"PARALLEL",label:l("project.dag.parallel")},{value:"SERIAL_WAIT",label:l("project.dag.serial_wait")},{value:"SERIAL_DISCARD",label:l("project.dag.serial_discard")},{value:"SERIAL_PRIORITY",label:l("project.dag.serial_priority")}],value:a.value.executionType,"onUpdate:value":i=>a.value.executionType=i},null)]}),p(I,{label:l("project.dag.global_variables"),path:"globalParams"},{default:()=>[p(xe,{value:a.value.globalParams,"onUpdate:value":i=>a.value.globalParams=i,preset:"pair","key-placeholder":l("project.dag.key"),"value-placeholder":l("project.dag.value"),class:"input-global-params"},null)]}),e.definition&&!e.instance&&p(I,{path:"timeoutFlag",showLabel:!1},{default:()=>[p(Q,{checked:a.value.release,"onUpdate:checked":i=>a.value.release=i},X(r=l("project.dag.online_directly"))?r:{default:()=>[r]})]}),e.instance&&p(I,{path:"sync",showLabel:!1},{default:()=>[p(Q,{checked:a.value.sync,"onUpdate:checked":i=>a.value.sync=i},X(d=l("project.dag.update_directly"))?d:{default:()=>[d]})]})]})]})}}});export{Ut as default};
