import{C as D}from"./index.97f03277.js";import{u as v,r as M,a as c,h as m,bl as K,d as $,w as q,o as F,t as A,c as a,_ as G,bH as H}from"./index.c5429249.js";import{_ as T}from"./lodash.084a01e7.js";import{u as X}from"./index.075b615e.js";import{u as J}from"./use-text-copy.51199844.js";import{c as Q,d as V,e as Y,f as Z,r as ee,h as oe}from"./index.cc06751b.js";import te from"./table-action.50eed8da.js";import{s as p}from"./index.module.e21b9b67.js";import{B as re}from"./index.3b9f9e63.js";import{D as ae,C as d,c as se}from"./column-width-config.63466f21.js";import{C as ie}from"./CopyOutlined.ff0f3037.js";import{N as O}from"./Space.e50db48f.js";import{a as le}from"./Dropdown.749e9383.js";import{N as f}from"./Button.c43a24dc.js";import{N as P}from"./Icon.8e3bf5ec.js";import{d as E}from"./Selection.a106a9c5.js";import ne from"./import-modal.1fdd1d36.js";import ce from"./start-modal.0937a5b5.js";import pe from"./timing-modal.903349fe.js";import de from"./version-modal.cb9503da.js";import me from"./copy-modal.cf08420f.js";import{S as we}from"./SearchOutlined.5b629110.js";import{N as fe}from"./Input.97d5419b.js";import{N as he,a as ue}from"./DataTable.d85b2298.js";import{N as _}from"./Tooltip.d759bd4b.js";import{N as ke}from"./Popconfirm.83d41c5f.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./keysOf.963e6f6c.js";import"./use-message.f235e8f1.js";import"./service.0215c8a4.js";import"./FormOutlined.848330c3.js";import"./PlayCircleOutlined.7616d1e9.js";import"./ClockCircleOutlined.6c97131a.js";import"./DownloadOutlined.8c21680b.js";import"./InfoCircleFilled.46393fdc.js";import"./DeleteOutlined.e68b06d7.js";import"./ApartmentOutlined.dacc84c9.js";import"./is-browser.d3e5def6.js";import"./flatten.a7868693.js";import"./get-slot.c85d6606.js";import"./Popover.df2981b4.js";import"./index.3e01cddc.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./format-length.e7c2072e.js";import"./utils.3eee947a.js";import"./use-compitable.b0459e69.js";import"./next-frame-once.da993024.js";import"./ChevronRight.f70a9c2d.js";import"./fade-in-scale-up.cssr.05526022.js";import"./use-keyboard.22724d1e.js";import"./use-locale.be539345.js";import"./Suffix.9ee1fead.js";import"./index.20e11ec3.js";import"./use-modal.4eacfaef.js";import"./index.fd50cc71.js";import"./index.8ea7b56a.js";import"./index.c537589f.js";import"./index.5926f13f.js";import"./common.145f2eef.js";import"./SettingOutlined.716a0298.js";import"./PauseCircleOutlined.813adbbb.js";import"./CloseCircleOutlined.46c86330.js";import"./CheckCircleOutlined.6daee0ce.js";import"./EditOutlined.af3970b8.js";import"./index.a2051d72.js";import"./CloudUploadOutlined.2cbd7c1d.js";import"./Form.13999875.js";import"./FormItem.51e71cc3.js";import"./Upload.6ed710a6.js";import"./Add.e846b00c.js";import"./Image.f79a9674.js";import"./ArrowUpOutlined.a96a5df0.js";import"./RadioGroup.47f9a37a.js";import"./Radio.5a2a0c2a.js";import"./Select.e833ee40.js";import"./Checkbox.7506e5f5.js";import"./DatePicker.fbb7ccb7.js";import"./Forward.23552619.js";import"./Switch.9ad161ba.js";import"./timezone.01550da9.js";import"./InputNumber.d8a1dfa4.js";import"./throttle.754ed9e3.js";import"./debounce.b14aac0d.js";import"./toNumber.5d1af176.js";import"./InputGroup.dbcafa91.js";import"./ExclamationCircleOutlined.e3fe8f60.js";import"./index.bbb6cfa3.js";import"./ArrowDown.db19052e.js";function ge(){const{t:s}=v(),l=K(),{copy:i}=J(),e=M({columns:[],tableWidth:ae,checkedRowKeys:[],row:{},tableData:[],projectCode:c(Number(l.currentRoute.value.params.projectCode)),page:c(1),pageSize:c(10),searchVal:c(),totalPage:c(1),showRef:c(!1),startShowRef:c(!1),timingShowRef:c(!1),versionShowRef:c(!1),copyShowRef:c(!1),loadingRef:c(!1)}),o=t=>{t.columns=[{type:"selection",className:"btn-selected",...d.selection},{title:"#",key:"id",...d.index,render:(r,n)=>n+1},{title:s("project.workflow.workflow_name"),key:"name",className:"workflow-name",width:200,render:r=>m(O,{justify:"space-between",wrap:!1,class:p["workflow-name"]},{default:()=>[m(re,{onClick:()=>void l.push({name:"workflow-definition-detail",params:{code:r.code}})},{default:()=>m(le,null,()=>r.name)}),m(f,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>void i(r.name)},{icon:()=>m(P,{size:16},()=>m(ie))})]})},{title:s("project.workflow.status"),key:"releaseState",...d.state,render:r=>r.releaseState==="ONLINE"?s("project.workflow.up_line"):s("project.workflow.down_line")},{title:s("project.workflow.create_time"),key:"createTime",...d.time},{title:s("project.workflow.update_time"),key:"updateTime",...d.time},{title:s("project.workflow.description"),key:"description",...d.note},{title:s("project.workflow.create_user"),key:"userName",...d.userName},{title:s("project.workflow.modify_user"),key:"modifyBy",...d.userName},{title:s("project.workflow.schedule_publish_status"),key:"scheduleReleaseState",...d.state,render:r=>r.scheduleReleaseState==="ONLINE"?m(E,{type:"success",size:"small"},{default:()=>s("project.workflow.up_line")}):r.scheduleReleaseState==="OFFLINE"?m(E,{type:"warning",size:"small"},{default:()=>s("project.workflow.down_line")}):"-"},{title:s("project.workflow.operation"),key:"operation",...d.operation(8.5),render:r=>m(te,{row:r,onEditWorkflow:()=>y(r),onStartWorkflow:()=>b(r),onTimingWorkflow:()=>j(r),onVersionWorkflow:()=>C(r),onDeleteWorkflow:()=>w(r),onReleaseWorkflow:()=>W(r),onCopyWorkflow:()=>U(r),onExportWorkflow:()=>x(r),onGotoTimingManage:()=>B(r),onGotoWorkflowTree:()=>I(r)})}],t.tableWidth&&(t.tableWidth=se(t.columns))},y=t=>{e.row=t,l.push({name:"workflow-definition-detail",params:{code:t.code}})},b=t=>{e.startShowRef=!0,e.row=t},j=t=>{e.timingShowRef=!0,e.row=t},C=t=>{e.versionShowRef=!0,e.row=t},w=t=>{Z(e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},S=()=>{const t={codes:T.join(e.checkedRowKeys,",")};Q(t,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},R=()=>{const t="workflow_"+new Date().getTime(),r={codes:T.join(e.checkedRowKeys,",")};V(r,e.projectCode).then(n=>{L(n,t),window.$message.success(s("project.workflow.success")),e.checkedRowKeys=[]})},N=()=>{},W=t=>{const r={name:t.name,releaseState:t.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};ee(r,e.projectCode,t.code).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},U=t=>{const r={codes:String(t.code),targetProjectCode:e.projectCode};oe(r,e.projectCode).then(()=>{window.$message.success(s("project.workflow.success")),k({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},L=(t,r="json")=>{if(!t)return;const n=new Blob([t]),h=`${r}.json`;if("download"in document.createElement("a")){const z=window.URL.createObjectURL(n),u=document.createElement("a");u.style.display="none",u.href=z,u.setAttribute("download",h),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(z)}else window.navigator.msSaveBlob&&window.navigator.msSaveBlob(n,h)},x=t=>{const r="workflow_"+new Date().getTime(),n={codes:String(t.code)};V(n,e.projectCode).then(h=>{L(h,r)})},B=t=>{l.push({name:"workflow-definition-timing",params:{projectCode:e.projectCode,definitionCode:t.code}})},I=t=>{l.push({name:"workflow-definition-tree",params:{projectCode:e.projectCode,definitionCode:t.code}})},k=t=>{if(e.loadingRef)return;e.loadingRef=!0;const{state:r}=X(Y({...t},e.projectCode).then(n=>{e.totalPage=n.totalPage,e.tableData=n.totalList.map(h=>({...h})),e.loadingRef=!1}),{total:0,table:[]});return r};return{variables:e,createColumns:o,getTableData:k,batchDeleteWorkflow:S,batchExportWorkflow:R,batchCopyWorkflow:N}}function g(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!G(s)}var st=$({name:"WorkflowDefinitionList",setup(){const s=K(),l=H(),i=Number(l.params.projectCode),{variables:e,createColumns:o,getTableData:y,batchDeleteWorkflow:b,batchExportWorkflow:j,batchCopyWorkflow:C}=ge(),w=()=>{y({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})},S=()=>{w()},R=()=>{e.checkedRowKeys=[],w()},N=()=>{e.page=1,w()},W=()=>{e.page=1,w()},U=()=>{s.push({path:`/projects/${i}/workflow/definitions/create`})};return q(v().locale,()=>{o(e)}),F(()=>{o(e),w()}),{requestData:w,handleSearch:N,handleUpdateList:S,createDefinition:U,handleChangePageSize:W,batchDeleteWorkflow:b,batchExportWorkflow:j,batchCopyWorkflow:C,handleCopyUpdateList:R,...A(e)}},render(){let s,l;const{t:i}=v(),{loadingRef:e}=this;return a("div",{class:p.content},[a(D,{class:p.card},{default:()=>[a("div",{class:p.header},[a(O,null,{default:()=>[a(f,{type:"primary",onClick:this.createDefinition,class:"btn-create-process"},g(s=i("project.workflow.create_workflow"))?s:{default:()=>[s]}),a(f,{strong:!0,secondary:!0,onClick:()=>this.showRef=!0},g(l=i("project.workflow.import_workflow"))?l:{default:()=>[l]})]}),a("div",{class:p.right},[a("div",{class:p.search},[a("div",{class:p.list},[a(f,{type:"primary",onClick:this.handleSearch},{default:()=>[a(P,null,{default:()=>[a(we,null,null)]})]})]),a("div",{class:p.list},[a(fe,{placeholder:i("resource.function.enter_keyword_tips"),value:this.searchVal,"onUpdate:value":o=>this.searchVal=o},null)])])])])]}),a(D,{title:i("project.workflow.workflow_definition")},{default:()=>[a(he,{loading:e,rowKey:o=>o.code,columns:this.columns,data:this.tableData,striped:!0,class:p.table,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":o=>this.checkedRowKeys=o,"row-class-name":"items",scrollX:this.tableWidth},null),a("div",{class:p.pagination},[a(ue,{page:this.page,"onUpdate:page":o=>this.page=o,"page-size":this.pageSize,"onUpdate:page-size":o=>this.pageSize=o,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]),a("div",{class:p["batch-button"]},[a(_,null,{default:()=>i("project.workflow.delete"),trigger:()=>a(ke,{onPositiveClick:this.batchDeleteWorkflow},{default:()=>i("project.workflow.delete_confirm"),trigger:()=>{let o;return a(f,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,class:"btn-delete-all"},g(o=i("project.workflow.delete"))?o:{default:()=>[o]})}})}),a(_,null,{default:()=>i("project.workflow.export"),trigger:()=>{let o;return a(f,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:this.batchExportWorkflow,class:"btn-delete-all"},g(o=i("project.workflow.export"))?o:{default:()=>[o]})}}),a(_,null,{default:()=>i("project.workflow.batch_copy"),trigger:()=>{let o;return a(f,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:()=>this.copyShowRef=!0,class:"btn-delete-all"},g(o=i("project.workflow.batch_copy"))?o:{default:()=>[o]})}})])]}),a(ne,{show:this.showRef,"onUpdate:show":o=>this.showRef=o,onUpdateList:this.handleUpdateList},null),a(ce,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.startShowRef,"onUpdate:show":o=>this.startShowRef=o,onUpdateList:this.handleUpdateList},null),a(pe,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.timingShowRef,"onUpdate:show":o=>this.timingShowRef=o,onUpdateList:this.handleUpdateList},null),a(de,{row:this.row,"onUpdate:row":o=>this.row=o,show:this.versionShowRef,"onUpdate:show":o=>this.versionShowRef=o,onUpdateList:this.handleUpdateList},null),a(me,{codes:this.checkedRowKeys,"onUpdate:codes":o=>this.checkedRowKeys=o,show:this.copyShowRef,"onUpdate:show":o=>this.copyShowRef=o,onUpdateList:this.handleCopyUpdateList},null)])}});export{st as default};
