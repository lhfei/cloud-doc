import{M as R}from"./index.20e11ec3.js";import{e as M,g as N,u as w,ah as I,r as b,a as l,d as v,w as p,t as x,c as r}from"./index.c5429249.js";import{u as y}from"./index.075b615e.js";import{l as U}from"./index.f239614a.js";import{s as d}from"./service.0215c8a4.js";import{f as h}from"./index.a2051d72.js";import{a as E,N as _}from"./DatePicker.fbb7ccb7.js";import{R as S}from"./ReloadOutlined.3fddf0fb.js";import{N as D}from"./Form.13999875.js";import{N as g}from"./FormItem.51e71cc3.js";import{a as A}from"./Select.e833ee40.js";import{N as L}from"./Space.e50db48f.js";import{N as G}from"./Input.97d5419b.js";import{N as O}from"./Button.c43a24dc.js";import{N as q}from"./Icon.8e3bf5ec.js";function C(e,s){M(2,arguments);var o=N(s);return E(e,-o)}function se(e){return d({url:"/access-tokens",method:"get",params:e})}function H(e){return d({url:"/access-tokens",method:"post",data:e})}function F(e){return d({url:`/access-tokens/${e.id}`,method:"put",data:e})}function ae(e){return d({url:`/access-tokens/${e}`,method:"delete",params:{id:e}})}function V(e){return d({url:"/access-tokens/generate",method:"post",data:e})}function j(e,s){const{t:o}=w(),a=I(),t=b({alertGroupFormRef:l(),model:{id:l(-1),userId:l(a.getUserInfo.userType==="GENERAL_USER"?a.getUserInfo.id:null),expireTime:l(Date.now()),token:l(""),generalOptions:[]},saving:!1,rules:{userId:{required:!0,trigger:["input","blur"],validator(){if(!t.model.userId)return new Error(o("security.token.user_tips"))}},expireTime:{required:!0,trigger:["input","blur"],validator(){if(!t.model.expireTime)return new Error(o("security.token.expiration_time_tips"))}},token:{required:!0,trigger:["input","blur"],validator(){if(t.model.token==="")return new Error(o("security.token.token_tips"))}}}}),m=()=>{const{state:n}=y(U().then(u=>{t.model.generalOptions=u.map(T=>({label:T.userName,value:T.id}))}),{});return n},c=()=>{const n={userId:a.getUserInfo.id,expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss")};y(V(n).then(u=>{t.model.token=u}),{})},i=async n=>{if(await t.alertGroupFormRef.validate(),!t.saving){t.saving=!0;try{n===0?await f():await k(),t.saving=!1}catch{t.saving=!1}}},f=()=>{const n={userId:Number(t.model.userId),expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss"),token:t.model.token};H(n).then(()=>{t.model.userId=a.getUserInfo.userType==="GENERAL_USER"?a.getUserInfo.id:null,t.model.expireTime=Date.now(),t.model.token="",s.emit("confirmModal",e.showModalRef)})},k=()=>{const n={id:t.model.id,userId:Number(t.model.userId),expireTime:h(t.model.expireTime,"yyyy-MM-dd HH:mm:ss"),token:t.model.token};F(n).then(()=>{s.emit("confirmModal",e.showModalRef)})};return{variables:t,handleValidate:i,getListData:m,getToken:c}}const B=v({name:"TokenModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(e,s){const{variables:o,handleValidate:a,getListData:t,getToken:m}=j(e,s),{t:c}=w(),i=I(),f=()=>{e.statusRef===0?(o.model.userId=i.getUserInfo.userType==="GENERAL_USER"?i.getUserInfo.id:null,o.model.expireTime=Date.now(),o.model.token=""):(o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token),s.emit("cancelModal",e.showModalRef)},k=()=>{a(e.statusRef)},n=()=>{e.statusRef!==0&&(o.model.token="")};return p(()=>e.showModalRef,()=>{e.showModalRef&&i.getUserInfo.userType!=="GENERAL_USER"&&t()}),p(()=>e.statusRef,()=>{e.statusRef===0?(o.model.userId=i.getUserInfo.userType==="GENERAL_USER"?i.getUserInfo.id:null,o.model.expireTime=Date.now(),o.model.token=""):(o.model.id=e.row.id,o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token)}),p(()=>e.row,()=>{o.model.id=e.row.id,o.model.userId=e.row.userId,o.model.expireTime=new Date(e.row.expireTime).getTime(),o.model.token=e.row.token}),{t:c,...x(o),cancelModal:f,confirmModal:k,getToken:m,changeUser:n,userStore:i}},render(){const{t:e,getToken:s,changeUser:o,userStore:a}=this;return r("div",null,[r(R,{title:this.statusRef===0?e("security.token.create_token"):e("security.token.edit_token"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.userId||!this.model.expireTime||!this.model.token,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>r(D,{model:this.model,rules:this.rules,ref:"alertGroupFormRef"},{default:()=>[r(g,{label:e("security.token.expiration_time"),path:"expireTime"},{default:()=>[r(_,{"is-date-disabled":t=>t<C(new Date,1),style:{width:"100%"},type:"datetime",clearable:!0,value:this.model.expireTime,"onUpdate:value":t=>this.model.expireTime=t},null)]}),a.getUserInfo.userType!=="GENERAL_USER"&&r(g,{label:e("security.token.user"),path:"userId"},{default:()=>[r(A,{class:"input-username",filterable:!0,placeholder:e("security.token.user_tips"),options:this.model.generalOptions,value:this.model.userId,"onUpdate:value":t=>this.model.userId=t,onUpdateValue:o},null)]}),r(g,{label:e("security.token.token"),path:"token"},{default:()=>[r(L,null,{default:()=>[r(G,{class:"input-token",style:{width:"504px"},disabled:!0,placeholder:e("security.token.token_tips"),value:this.model.token,"onUpdate:value":t=>this.model.token=t},null),r(O,{class:"btn-generate-token",strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>s()},{icon:()=>r(q,null,{default:()=>[r(S,null,null)]})})]})]})]})})])}});var ie=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{B as T,ae as d,se as q,ie as t};
