import{d as j,bB as R,bz as C,bA as x,br as w,u as v,bH as z,bl as L,r as S,a as n,h as o}from"./index.c5429249.js";import{u as D}from"./index.075b615e.js";import{s as I}from"./service.0215c8a4.js";import{B as P}from"./index.3b9f9e63.js";import{r as m,p as h,t as H}from"./common.145f2eef.js";import{D as E,C as r,c as O}from"./column-width-config.63466f21.js";import{C as B}from"./CheckCircleOutlined.6daee0ce.js";import{D as M}from"./DownloadOutlined.8c21680b.js";import{f as N}from"./index.a2051d72.js";import{a as A}from"./Dropdown.749e9383.js";import{N as d}from"./Tooltip.d759bd4b.js";import{N as f}from"./Button.c43a24dc.js";import{N as u}from"./Icon.8e3bf5ec.js";import{N as V}from"./Space.e50db48f.js";import{N as W}from"./Spin.1e9405a1.js";const F={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},U=x("path",{d:"M120 230h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm0 424h496c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm784 140H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0-424H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z",fill:"currentColor"},null,-1),$=[U];var q=j({name:"AlignLeftOutlined",render:function(c,i){return R(),C("svg",F,$)}});function G(e,c){return I({url:`/projects/${c.projectCode}/task-instances`,method:"get",params:e})}function K(e,c){return I({url:`/projects/${c.projectCode}/task-instances/${e.id}/force-success`,method:"post"})}function Y(e){w.downloadFile("log/download-log",{taskInstanceId:e})}function pe(){const{t:e}=v(),c=z(),i=L(),l=Number(c.params.projectCode),k=Number(c.params.processInstanceId),s=S({columns:[],tableWidth:E,tableData:[],page:n(1),pageSize:n(10),searchVal:n(null),processInstanceId:n(k||null),host:n(null),stateType:n(null),datePickerRange:n(null),executorName:n(null),processInstanceName:n(null),totalPage:n(1),showModalRef:n(!1),row:{},loadingRef:n(!1),logRef:"",logLoadingRef:n(!0),skipLineNum:n(0),limit:n(1e3)}),T=a=>{a.columns=[{title:"#",key:"index",render:(t,p)=>p+1,...r.index},{title:e("project.task.task_name"),key:"name",...r.name},{title:e("project.task.workflow_instance"),key:"processInstanceName",...r.linkName,render:t=>o(P,{onClick:()=>void i.push({name:"workflow-instance-detail",params:{id:t.processInstanceId},query:{code:l}})},{default:()=>o(A,r.linkEllipsis,()=>t.processInstanceName)})},{title:e("project.task.executor"),key:"executorName",...r.name},{title:e("project.task.node_type"),key:"taskType",...r.type},{title:e("project.task.state"),key:"state",...r.state,render:t=>J(t.state,e)},{title:e("project.task.submit_time"),...r.time,key:"submitTime",render:t=>m(t.submitTime)},{title:e("project.task.start_time"),...r.time,key:"startTime",render:t=>m(t.startTime)},{title:e("project.task.end_time"),...r.time,key:"endTime",render:t=>m(t.endTime)},{title:e("project.task.duration"),key:"duration",...r.duration,render:t=>o("span",null,t.duration?t.duration:"-")},{title:e("project.task.retry_count"),key:"retryTimes",...r.times},{title:e("project.task.dry_run_flag"),key:"dryRun",...r.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:e("project.task.host"),key:"host",...r.name,render:t=>t.host||"-"},{title:e("project.task.operation"),key:"operation",...r.operation(3),render(t){return o(V,null,{default:()=>[o(d,{},{trigger:()=>o(f,{tag:"div",circle:!0,type:"info",size:"small",disabled:!(t.state==="FAILURE"||t.state==="NEED_FAULT_TOLERANCE"||t.state==="KILL"),onClick:()=>{b(t)}},{icon:()=>o(u,null,{default:()=>o(B)})}),default:()=>e("project.task.forced_success")}),o(d,{},{trigger:()=>o(f,{circle:!0,type:"info",size:"small",disabled:!t.host,onClick:()=>_(t)},{icon:()=>o(u,null,{default:()=>o(q)})}),default:()=>e("project.task.view_log")}),o(d,{},{trigger:()=>o(f,{circle:!0,type:"info",size:"small",onClick:()=>Y(t.id)},{icon:()=>o(u,null,{default:()=>o(M)})}),default:()=>e("project.task.download_log")})]})}}],a.tableWidth&&(a.tableWidth=O(a.columns))},_=a=>{s.showModalRef=!0,s.row=a},b=a=>{K({id:a.id},{projectCode:l}).then(()=>{g({pageSize:s.pageSize,pageNo:s.tableData.length===1&&s.page>1?s.page-1:s.page,searchVal:s.searchVal,processInstanceId:s.processInstanceId,host:s.host,stateType:s.stateType,datePickerRange:s.datePickerRange,executorName:s.executorName,processInstanceName:s.processInstanceName})})},g=a=>{if(s.loadingRef)return;s.loadingRef=!0;const t={pageSize:a.pageSize,pageNo:a.pageNo,searchVal:a.searchVal,processInstanceId:a.processInstanceId,host:a.host,stateType:a.stateType,startDate:a.datePickerRange?N(h(a.datePickerRange[0]),"yyyy-MM-dd HH:mm:ss"):"",endDate:a.datePickerRange?N(h(a.datePickerRange[1]),"yyyy-MM-dd HH:mm:ss"):"",executorName:a.executorName,processInstanceName:a.processInstanceName},{state:p}=D(G(t,{projectCode:l}).then(y=>{s.tableData=y.totalList,s.totalPage=y.totalPage,s.loadingRef=!1}),{});return p};return{t:e,variables:s,getTableData:g,createColumns:T}}function J(e,c){if(!e)return"";const i=H(c)[e],l=o(u,{color:i.color,class:i.classNames,style:{display:"flex"},size:20},()=>o(i.icon));return o(d,null,{trigger:()=>i.isSpin?o(W,{size:20},{icon:()=>l}):l,default:()=>i.desc})}export{J as r,pe as u};
