import{d as j,bz as x,bA as d,bB as V,a as N,u as K,aj as X,n as Y,c as e,_ as Z,a2 as ee,bH as te,bl as oe}from"./index.c5429249.js";import{S as l}from"./dag.module.868c5c8a.js";import{D as le}from"./track.558e9151.js";import"./lodash.084a01e7.js";import{b as re}from"./index.075b615e.js";import"./dag-context-menu.87eb6a4b.js";import"./gForce.96ee147a.js";import{u as ne}from"./use-text-copy.51199844.js";import"./service.0215c8a4.js";import"./dag-node-status.4be2745c.js";import"./task-node.0b2752c6.js";import ae from"./dag-startup-param.21037cf7.js";import ie from"./variables-view.f40e3ebd.js";import{C as se}from"./CopyOutlined.ff0f3037.js";import{S as ce}from"./SearchOutlined.5b629110.js";import{D as ue}from"./DownloadOutlined.8c21680b.js";import{S as de}from"./SyncOutlined.859a474f.js";import{D as me}from"./DeleteOutlined.e68b06d7.js";import{F as pe,a as fe}from"./FullscreenOutlined.135d7d35.js";import{I as ge}from"./InfoCircleOutlined.9a8e087c.js";import{N as i}from"./Tooltip.d759bd4b.js";import{N as n}from"./Button.c43a24dc.js";import{N as s}from"./Icon.8e3bf5ec.js";import{d as he}from"./Selection.a106a9c5.js";import{N as E}from"./Popover.df2981b4.js";import{N as R}from"./text.6383fc2d.js";import{a as ve}from"./Select.e833ee40.js";import"./toNumber.5d1af176.js";import"./fade-in.cssr.9da325c6.js";import"./debounce.b14aac0d.js";import"./index.bdf8fa15.js";import"./common.145f2eef.js";import"./SettingOutlined.716a0298.js";import"./PauseCircleOutlined.813adbbb.js";import"./CloseCircleOutlined.46c86330.js";import"./CheckCircleOutlined.6daee0ce.js";import"./EditOutlined.af3970b8.js";import"./ClockCircleOutlined.6c97131a.js";import"./index.a2051d72.js";import"./is-browser.d3e5def6.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./use-message.f235e8f1.js";import"./Spin.1e9405a1.js";import"./index.16077d24.js";import"./use-compitable.b0459e69.js";import"./format-length.e7c2072e.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./VResizeObserver.14b04bb7.js";import"./utils.3eee947a.js";import"./next-frame-once.da993024.js";import"./index.c537589f.js";import"./index.fd50cc71.js";import"./index.31c70196.js";import"./use-locale.be539345.js";import"./Suffix.9ee1fead.js";import"./fade-in-scale-up.cssr.05526022.js";const we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},_e=d("defs",null,null,-1),be=d("path",{d:"M840 192h-56v-72c0-13.3-10.7-24-24-24H168c-13.3 0-24 10.7-24 24v272c0 13.3 10.7 24 24 24h592c13.3 0 24-10.7 24-24V256h32v200H465c-22.1 0-40 17.9-40 40v136h-44c-4.4 0-8 3.6-8 8v228c0 .6.1 1.3.2 1.9c-.1 2-.2 4.1-.2 6.1c0 46.4 37.6 84 84 84s84-37.6 84-84c0-2.1-.1-4.1-.2-6.1c.1-.6.2-1.2.2-1.9V640c0-4.4-3.6-8-8-8h-44V520h351c22.1 0 40-17.9 40-40V232c0-22.1-17.9-40-40-40zM720 352H208V160h512v192zM477 876c0 11-9 20-20 20s-20-9-20-20V696h40v180z",fill:"currentColor"},null,-1),ye=[_e,be];var Ce=j({name:"FormatPainterOutlined",render:function(r,t){return V(),x("svg",we,ye)}});const ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Ne=d("defs",null,null,-1),je=d("path",{d:"M956 686.5l-.1-.1l-.1-.1C911.7 593 843.4 545 752.5 545s-159.2 48.1-203.4 141.3v.1c-5.4 11.5-5.4 24.9 0 36.4C593.3 816 661.6 864 752.5 864s159.2-48.1 203.4-141.3c5.4-11.5 5.4-24.8.1-36.2zM752.5 800c-62.1 0-107.4-30-141.1-95.5C645 639 690.4 609 752.5 609c62.1 0 107.4 30 141.1 95.5C860 770 814.6 800 752.5 800z",fill:"currentColor"},null,-1),Se=d("path",{d:"M697 705a56 56 0 1 0 112 0a56 56 0 1 0-112 0z",fill:"currentColor"},null,-1),xe=d("path",{d:"M136 232h704v253h72V192c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h352v-72H136V232z",fill:"currentColor"},null,-1),Ve=d("path",{d:"M724.9 338.1l-36.8-36.8c-3.1-3.1-8.2-3.1-11.3 0L493 485.3l-86.1-86.2c-3.1-3.1-8.2-3.1-11.3 0L251.3 543.4c-3.1 3.1-3.1 8.2 0 11.3l36.8 36.8c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8l86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.2-3.1 3.2-8.2 0-11.3z",fill:"currentColor"},null,-1),Oe=[Ne,je,Se,xe,Ve];var Te=j({name:"FundViewOutlined",render:function(r,t){return V(),x("svg",ke,Oe)}});const De={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ze=d("path",{d:"M666.7 505.5l-246-178A8 8 0 0 0 408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512L421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z",fill:"currentColor"},null,-1),$e=d("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),Fe=[ze,$e];var Me=j({name:"RightCircleOutlined",render:function(r,t){return V(),x("svg",De,Fe)}});function Ie(o){const r=N(""),{graph:t}=o,_=N(!1),f=()=>{_.value=!_.value},g=N([]),m=()=>{var C;const v=((C=t.value)==null?void 0:C.getNodes())||[];g.value=v.map(w=>({label:w.getData().taskName,value:w.id})),g.value.findIndex(w=>w.value===r.value)===-1&&(r.value="")};function S(v){if(r.value=v,!t.value)return;const b=t.value.getCellById(v);t.value.scrollToCell(b,{animation:{duration:600}}),t.value.cleanSelection(),t.value.select(b)}return{searchSelectValue:r,navigateTo:S,toggleSearchInput:f,searchInputVisible:_,reQueryNodes:m,nodesDropdown:g}}function y(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!Z(o)}const Be={layoutToggle:{type:Function,default:()=>{}},instance:{type:Object,default:null},definition:{type:Object,default:null}};var qt=j({name:"workflow-dag-toolbar",props:Be,emits:["versionToggle","saveModelToggle","removeTasks","refresh"],setup(o,r){const{t}=K(),_=X(),f=Y("graph",N()),g=oe(),m=te(),{searchSelectValue:S,navigateTo:v,toggleSearchInput:b,searchInputVisible:C,reQueryNodes:w,nodesDropdown:q}=Ie({graph:f}),U=(p={fileName:"dag",bgColor:"#f2f3f7"})=>{var c;const{fileName:a,bgColor:h}=p;(c=f.value)==null||c.toPNG(k=>{le.downloadDataUri(k,`${a}.png`)},{padding:{top:50,right:50,bottom:50,left:50},backgroundColor:h})},{isFullscreen:O,toggle:A}=re(),G=()=>{r.emit("versionToggle",!0)},Q=()=>{o.layoutToggle(!0)},W=()=>{if(history.state.back!=="/login"){g.go(-1);return}if(history.state.current.includes("workflow/definitions")){g.push({path:`/projects/${m.params.projectCode}/workflow-definition`});return}if(history.state.current.includes("workflow/instances")){g.push({path:`/projects/${m.params.projectCode}/workflow/instances`});return}},{copy:T}=ne(),J=()=>{var p;if(f.value){const a=f.value.getSelectedCells();if(a){const h=a.filter(c=>c.isNode()).map(c=>+c.id);r.emit("removeTasks",h,a),(p=f.value)==null||p.removeCells(a)}}};return()=>{var c,k,D,z,$,F,M,I,B;let p,a,h;return e("div",{class:[l.toolbar,l[_.darkTheme?"toolbar-dark":"toolbar-light"]]},[e("span",{class:l["workflow-name"]},[m.name==="workflow-instance-detail"?(c=o.instance)==null?void 0:c.name:((D=(k=o.definition)==null?void 0:k.processDefinition)==null?void 0:D.name)||t("project.dag.create")]),(($=(z=o.definition)==null?void 0:z.processDefinition)==null?void 0:$.name)&&e(i,null,{trigger:()=>e(n,{quaternary:!0,circle:!0,onClick:()=>{var H,P,L;const u=m.name==="workflow-instance-detail"?(H=o.instance)==null?void 0:H.name:(L=(P=o.definition)==null?void 0:P.processDefinition)==null?void 0:L.name;T(u)},class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(se,null,null)]})]}),default:()=>t("project.dag.copy_name")}),e("div",{class:l["toolbar-left-part"]},[m.name!=="workflow-instance-detail"&&((M=(F=o.definition)==null?void 0:F.processDefinition)==null?void 0:M.releaseState)==="ONLINE"&&e(he,{round:!0,size:"small",type:"info"},y(p=t("project.dag.online"))?p:{default:()=>[p]}),m.name==="workflow-instance-detail"&&e(ee,null,[e(i,null,{trigger:()=>e(E,{placement:"bottom",trigger:"click",scrollable:!0,style:{maxWidth:"50vw",maxHeight:"70vh"}},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(Te,null,null)]})]}),header:()=>{let u;return e(R,{strong:!0,depth:1},y(u=t("project.workflow.parameters_variables"))?u:{default:()=>[u]})},default:()=>e(ie,{onCopy:T},null)}),default:()=>t("project.dag.view_variables")}),e(i,null,{trigger:()=>e(E,{placement:"bottom",trigger:"click"},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(Me,null,null)]})]}),header:()=>{let u;return e(R,{strong:!0,depth:1},y(u=t("project.workflow.startup_parameter"))?u:{default:()=>[u]})},default:()=>e(ae,{startupParam:o.instance},null)}),default:()=>t("project.dag.startup_parameter")})])]),e("div",{class:l["toolbar-right-part"]},[e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:b},{icon:()=>e(s,null,{default:()=>[e(ce,null,null)]})}),default:()=>t("project.dag.search")}),e("div",{class:`${l["toolbar-right-item"]} ${l["node-selector"]} ${C.value?l.visible:""}`},[e(ve,{size:"small",value:S.value,options:q.value,onFocus:w,onUpdateValue:v,filterable:!0},null)]),e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>U()},{icon:()=>e(s,null,{default:()=>[e(ue,null,null)]})}),default:()=>t("project.dag.download_png")}),o.instance&&e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>{r.emit("refresh")}},{icon:()=>e(s,null,{default:()=>[e(de,null,null)]})}),default:()=>t("project.dag.refresh_dag_status")}),e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>J()},{icon:()=>e(s,null,{default:()=>[e(me,null,null)]})}),default:()=>t("project.dag.delete_cell")}),e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:A},{icon:()=>e(s,null,{default:()=>[O.value?e(pe,null,null):e(fe,null,null)]})}),default:()=>O.value?t("project.dag.fullscreen_close"):t("project.dag.fullscreen_open")}),e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Q},{icon:()=>e(s,null,{default:()=>[e(Ce,null,null)]})}),default:()=>t("project.dag.format")}),!!o.definition&&e(i,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:G},{icon:()=>e(s,null,{default:()=>[e(ge,null,null)]})}),default:()=>t("project.workflow.version_info")}),e(n,{class:[l["toolbar-right-item"],"btn-save"],type:"info",secondary:!0,round:!0,disabled:((B=(I=o.definition)==null?void 0:I.processDefinition)==null?void 0:B.releaseState)==="ONLINE"&&!o.instance,onClick:()=>{r.emit("saveModelToggle",!0)}},y(a=t("project.dag.save"))?a:{default:()=>[a]}),e(n,{secondary:!0,round:!0,onClick:W,class:"btn-close"},y(h=t("project.dag.close"))?h:{default:()=>[h]})])])}}});export{qt as default};
