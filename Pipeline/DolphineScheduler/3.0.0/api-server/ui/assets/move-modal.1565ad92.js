import{M as u}from"./index.20e11ec3.js";import{u as d,bH as h,r as D,a,d as C,w as c,t as g,c as n}from"./index.c5429249.js";import{u as k}from"./index.075b615e.js";import{q as v}from"./index.cc06751b.js";import{s as w}from"./service.0215c8a4.js";import{N as M}from"./Form.13999875.js";import{N as P}from"./FormItem.51e71cc3.js";import{a as b}from"./Select.e833ee40.js";import"./index.3b9f9e63.js";import"./Button.c43a24dc.js";import"./is-browser.d3e5def6.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./keysOf.963e6f6c.js";import"./Card.c707a1eb.js";import"./index.16077d24.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./fade-in-scale-up.cssr.05526022.js";import"./utils.3eee947a.js";import"./Space.e50db48f.js";import"./get-slot.c85d6606.js";import"./lodash.084a01e7.js";import"./format-length.e7c2072e.js";import"./use-locale.be539345.js";import"./use-compitable.b0459e69.js";import"./Selection.a106a9c5.js";import"./Popover.df2981b4.js";import"./next-frame-once.da993024.js";import"./Suffix.9ee1fead.js";function j(o,t){return w({url:`/projects/${t}/process-task-relation/move`,method:"post",data:o})}function N(){const{t:o}=d(),t=h(),i=Number(t.params.projectCode),e=D({taskCode:a(""),processDefinitionCode:a(""),refreshTaskDefinition:a(!1),taskDefinitionFormRef:a(),model:{targetProcessDefinitionCode:a(""),generalOptions:[]},saving:!1,rules:{targetProcessDefinitionCode:{required:!0,trigger:["change","blur"],validator(){if(!e.model.targetProcessDefinitionCode)return new Error(o("project.task.workflow_name_tips"))}}}}),s=()=>{const{state:r}=k(v(i).then(p=>{e.model.generalOptions=p.map(f=>({label:f.name,value:f.code}))}),{});return r},m=()=>{e.taskDefinitionFormRef.validate(r=>{r||l()})},l=async()=>{if(!e.saving){e.saving=!0;try{const r={targetProcessDefinitionCode:e.model.targetProcessDefinitionCode,taskCode:e.taskCode,processDefinitionCode:e.processDefinitionCode};await j(r,i),e.saving=!1,e.model.targetProcessDefinitionCode="",e.refreshTaskDefinition=!0}catch{e.saving=!1}}};return{variables:e,handleValidate:m,getListData:s}}const y={show:{type:Boolean,default:!1},row:{type:Object,default:{}}},ne=C({name:"MoveModal",props:y,emits:["refresh","cancel"],setup(o,t){const{t:i}=d(),{variables:e,handleValidate:s,getListData:m}=N(),l=()=>{e.model.targetProcessDefinitionCode="",t.emit("cancel")},r=()=>{s()};return c(()=>o.show,()=>{e.taskCode=o.row.taskCode,e.processDefinitionCode=o.row.processDefinitionCode,e.model.targetProcessDefinitionCode=o.row.processDefinitionCode,o.show&&m()}),c(()=>e.refreshTaskDefinition,()=>{e.refreshTaskDefinition&&(t.emit("refresh"),e.refreshTaskDefinition=!1)}),{t:i,...g(e),cancelModal:l,confirmModal:r}},render(){const{t:o,show:t,cancelModal:i,confirmModal:e}=this;return n(u,{title:o("project.task.move"),show:t,onCancel:i,onConfirm:e,confirmDisabled:!this.model.targetProcessDefinitionCode,confirmLoading:this.saving},{default:()=>[n(M,{model:this.model,rules:this.rules,ref:"taskDefinitionFormRef"},{default:()=>[n(P,{label:o("project.task.workflow_name"),path:"alertInstanceIds"},{default:()=>[n(b,{placeholder:o("project.task.workflow_name_tips"),options:this.model.generalOptions,value:this.model.targetProcessDefinitionCode,"onUpdate:value":s=>this.model.targetProcessDefinitionCode=s},null)]})]})]})}});export{ne as default};
