import{u,X as v,r as R,a as f,bl as g,d as N,t as _,c as t,_ as b}from"./index.c5429249.js";import{M as w}from"./index.20e11ec3.js";import{u as U}from"./file.0dabb2be.js";import{d as y}from"./index.8259a597.js";import{N as q}from"./Upload.6ed710a6.js";import{N as C}from"./Form.13999875.js";import{N as n}from"./FormItem.51e71cc3.js";import{N as F}from"./Input.97d5419b.js";import{N as D}from"./Button.c43a24dc.js";import"./index.3b9f9e63.js";import"./keysOf.963e6f6c.js";import"./Card.c707a1eb.js";import"./use-rtl.c78ffbd8.js";import"./resolve-slot.7c241306.js";import"./index.16077d24.js";import"./index.3e01cddc.js";import"./flatten.a7868693.js";import"./Scrollbar.12b40993.js";import"./fade-in.cssr.9da325c6.js";import"./VResizeObserver.14b04bb7.js";import"./fade-in-scale-up.cssr.05526022.js";import"./utils.3eee947a.js";import"./is-browser.d3e5def6.js";import"./Space.e50db48f.js";import"./get-slot.c85d6606.js";import"./service.0215c8a4.js";import"./lodash.084a01e7.js";import"./Add.e846b00c.js";import"./format-length.e7c2072e.js";import"./Image.f79a9674.js";import"./use-locale.be539345.js";import"./Tooltip.d759bd4b.js";import"./Popover.df2981b4.js";import"./use-compitable.b0459e69.js";import"./next-frame-once.da993024.js";import"./Suffix.9ee1fead.js";const h=()=>({name:"",file:"",description:"",pid:-1,currentDir:"/"});function M(){const{t:o}=u(),r=()=>{e.uploadForm=Object.assign(v(e.uploadForm),h())},e=R({uploadFormRef:f(),uploadFormNameRef:f(),uploadForm:h(),saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(e.uploadForm.name==="")return new Error(o("resource.file.enter_name_tips"))}},file:{required:!0,trigger:["input","blur"],validator(){if(e.uploadForm.file==="")return new Error(o("resource.file.enter_content_tips"))}}}});return{state:e,resetForm:r}}function S(o){const{t:r}=u(),e=g(),i=U();return{handleUploadFile:async(l,d,c)=>{if(await o.uploadFormRef.validate(),!o.saving){o.saving=!0;try{const p=e.currentRoute.value.params.id||-1,s=i.getCurrentDir||"/",a=new FormData;a.append("file",o.uploadForm.file),a.append("type","FILE"),a.append("name",o.uploadForm.name),a.append("pid",String(p)),a.append("currentDir",s),a.append("description",o.uploadForm.description),await y(a),window.$message.success(r("resource.file.success")),o.saving=!1,l("updateList"),d(),c()}catch{o.saving=!1}}}}}function j(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!b(o)}const I={show:{type:Boolean,default:!1}};var Fe=N({name:"ResourceFileUpload",props:I,emits:["updateList","update:show"],setup(o,r){const{state:e,resetForm:i}=M(),{handleUploadFile:m}=S(e),l=()=>{i(),r.emit("update:show")};return{hideModal:l,customRequest:({file:s})=>{e.uploadForm.name=s.name,e.uploadForm.file=s.file,e.uploadFormRef.validate()},handleFile:()=>{m(r.emit,l,i)},removeFile:()=>{e.uploadForm.name="",e.uploadForm.file=""},..._(e)}},render(){let o;const{t:r}=u();return t(w,{show:this.$props.show,title:r("resource.file.upload_files"),onCancel:this.hideModal,onConfirm:this.handleFile,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>[t(C,{rules:this.rules,ref:"uploadFormRef"},{default:()=>[t(n,{label:r("resource.file.file_name"),path:"name",ref:"uploadFormNameRef"},{default:()=>[t(F,{value:this.uploadForm.name,"onUpdate:value":e=>this.uploadForm.name=e,placeholder:r("resource.file.enter_name_tips"),class:"input-file-name"},null)]}),t(n,{label:r("resource.file.description"),path:"description"},{default:()=>[t(F,{type:"textarea",value:this.uploadForm.description,"onUpdate:value":e=>this.uploadForm.description=e,placeholder:r("resource.file.enter_description_tips"),class:"input-description"},null)]}),t(n,{label:r("resource.file.upload_files"),path:"file"},{default:()=>[t(q,{value:this.uploadForm.file,"onUpdate:value":e=>this.uploadForm.file=e,customRequest:this.customRequest,class:"btn-upload",max:1,onRemove:this.removeFile},{default:()=>[t(D,null,j(o=r("resource.file.upload_files"))?o:{default:()=>[o]})]})]})]})]})}});export{Fe as default};
