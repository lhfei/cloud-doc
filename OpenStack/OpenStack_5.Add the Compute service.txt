----------------------------------------------------------
----------------------------------------------------------
## OpenStack Compute
----------------------------------------------------------
Install and configure controller node
----------------------------------------------------------

----------------------------------------------------------

----------------------------------------------------------
#1. To create the database, complete these steps:
----------------------------------------------------------
>mysql -u root -p
>CREATE DATABASE nova;

>GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'localhost' \
  IDENTIFIED BY 'Ifeng01';
>GRANT ALL PRIVILEGES ON nova.* TO 'nova'@'%' \
  IDENTIFIED BY 'Ifeng01';
----------------------------------------------------------

----------------------------------------------------------
#2. Source the admin credentials to gain access to admin-only CLI commands:
----------------------------------------------------------

----------------------------------------------------------
#3. To create the service credentials, complete these steps:
----------------------------------------------------------
#Create the nova user[password:Lhfei**]:
>openstack user create --password-prompt nova

	+----------+----------------------------------+
	| Field    | Value                            |
	+----------+----------------------------------+
	| email    | None                             |
	| enabled  | True                             |
	| id       | 8cb34d0dc03a44c09df40558879dd719 |
	| name     | nova                             |
	| username | nova                             |
	+----------+----------------------------------+

#Add the admin role to the nova user:
>openstack role add --project service --user nova admin

	+-------+----------------------------------+
	| Field | Value                            |
	+-------+----------------------------------+
	| id    | 4c96e41f9d8c4f8eb80c537045fd9b26 |
	| name  | admin                            |
	+-------+----------------------------------+
	
>openstack role list --project service --user nova admin
+----------------------------------+-------+---------+------+
| ID                               | Name  | Project | User |
+----------------------------------+-------+---------+------+
| 4c96e41f9d8c4f8eb80c537045fd9b26 | admin | service | nova |
+----------------------------------+-------+---------+------+

#Create the nova service entity:
>openstack service create --name nova \
  --description "OpenStack Compute" compute

	+-------------+----------------------------------+
	| Field       | Value                            |
	+-------------+----------------------------------+
	| description | OpenStack Compute                |
	| enabled     | True                             |
	| id          | 77e47ce6e274460ab4ef64bdc73ef6b2 |
	| name        | nova                             |
	| type        | compute                          |
	+-------------+----------------------------------+
	
----------------------------------------------------------
## 4. Create the Compute service API endpoint:
----------------------------------------------------------
>openstack endpoint create \
  --publicurl http://ubuntu126:8774/v2/%\(tenant_id\)s \
  --internalurl http://ubuntu126:8774/v2/%\(tenant_id\)s \
  --adminurl http://ubuntu126:8774/v2/%\(tenant_id\)s \
  --region RegionOne \
  compute
	
	+--------------+---------------------------------------------------+
	| Field        | Value                                             |
	+--------------+---------------------------------------------------+
	| adminurl     | http://ubuntu126.thinker.cn:8774/v2/%(tenant_id)s |
	| enabled      | True                                              |
	| id           | 086d8229a66349df97bbdd5f536be487                  |
	| internalurl  | http://ubuntu126.thinker.cn:8774/v2/%(tenant_id)s |
	| publicurl    | http://ubuntu126.thinker.cn:8774/v2/%(tenant_id)s |
	| region       | RegionOne                                         |
	| service_id   | 77e47ce6e274460ab4ef64bdc73ef6b2                  |
	| service_name | nova                                              |
	| service_type | compute                                           |
	+--------------+---------------------------------------------------+	
----------------------------------------------------------

----------------------------------------------------------
## To install and configure Compute controller components
----------------------------------------------------------
1. Install the packages:
>apt-get install nova-api nova-cert nova-conductor nova-consoleauth \
  nova-novncproxy nova-scheduler python-novaclient
----------------------------------------------------------

----------------------------------------------------------
2. Edit the /etc/nova/nova.conf file and complete the following actions:

	+-------------------------------------------------------------------+
	|								  									+
	[database]						  									
	connection = mysql://nova:Ifeng01@ubuntu126.thinker.cn/nova     			
	
	[oslo_messaging_rabbit]
	rabbit_host = ubuntu126.thinker.cn
	rabbit_userid = openstack
	rabbit_password = Ifeng01
	
	[keystone_authtoken]
	auth_uri = http://ubuntu126.thinker.cn:5000
	auth_url = http://ubuntu126.thinker.cn:35357
	auth_plugin = password
	project_domain_id = default
	user_domain_id = default
	project_name = service
	username = nova
	password = Lhfei01	  
	
	[DEFAULT]                                                          
	rpc_backend = rabbit
	auth_strategy = keystone
	verbose = True		
	my_ip = 114.80.177.126
	vncserver_listen = 114.80.177.126
	vncserver_proxyclient_address = 114.80.177.126
	
	[glance]
	host = ubuntu126.thinker.cn
	
	[oslo_concurrency]
	lock_path = /var/lib/nova/tmp
	

	+-------------------------------------------------------------------+
----------------------------------------------------------
3. Populate the Compute database:
>su -s /bin/sh -c "nova-manage db sync" nova
----------------------------------------------------------

----------------------------------------------------------
----------------------------------------------------------
#### To finalize installation
----------------------------------------------------------
1.Restart the Compute services:
>service nova-api restart
>service nova-cert restart
>service nova-consoleauth restart
>service nova-scheduler restart
>service nova-conductor restart
>service nova-novncproxy restart

2. By default, the Ubuntu packages create an SQLite database. 
>rm -f /var/lib/nova/nova.sqlite
----------------------------------------------------------

----------------------------------------------------------
----------------------------------------------------------
##########################################################
## @@@@ Compute Nodes                                   ##
#### Install and configure a compute node [114.80.177.127]
----------------------------------------------------------
#To install and configure the Compute hypervisor components
----------------------------------------------------------
1. Install the packages:
>apt-get install nova-compute sysfsutils

	+---------------------------------------------------------+
	|# Pls check libparted0debian1  has been installed:		  |
	|.... http://packages.ubuntu.com/trusty/libparted0debian1 |
	|# This step is very important. KVM must be installed.    |
	|# How to install kvm in Ubuntu14, pls see:               |
	|.... https://help.ubuntu.com/community/KVM/Installation  |
	+---------------------------------------------------------+

----------------------------------------------------------
2. Edit the /etc/nova/nova.conf file and complete the following actions:

	+-------------------------------------------------------------------+
	|	
	+
	[DEFAULT]                                                          
	rpc_backend = rabbit
	auth_strategy = keystone
	verbose = True		
	my_ip = 114.80.177.127
	vncserver_listen = 0.0.0.0
	vncserver_proxyclient_address = 114.80.177.127	
	vnc_enabled = True
	novncproxy_base_url = http://ubuntu126.thinker.cn:6080/vnc_auto.html
	
	[oslo_messaging_rabbit]
	rabbit_host = ubuntu126.thinker.cn
	rabbit_userid = openstack
	rabbit_password = Ifeng01
	
	[keystone_authtoken]
	auth_uri = http://ubuntu126.thinker.cn:5000
	auth_url = http://ubuntu126.thinker.cn:35357
	auth_plugin = password
	project_domain_id = default
	user_domain_id = default
	project_name = service
	username = nova
	password = Lhfei01	  

	[glance]
	host = ubuntu126.thinker.cn
	
	[oslo_concurrency]
	lock_path = /var/lib/nova/tmp
	

	+-------------------------------------------------------------------+
----------------------------------------------------------
## To finalize installation
----------------------------------------------------------
1. Determine whether your compute node supports hardware acceleration for virtual machines:
>egrep -c '(vmx|svm)' /proc/cpuinfo

#Edit the [libvirt] section in the /etc/nova/nova-compute.conf file as follows:

	[libvirt]
	virt_type = qemu

2. service nova-compute restart
>service nova-compute restart

3. By default, the Ubuntu packages create an SQLite database.
Because this configuration uses a SQL database server, you can remove the SQLite database file:
>rm -f /var/lib/nova/nova.sqlite
----------------------------------------------------------
----------------------------------------------------------

----------------------------------------------------------
----------------------------------------------------------
#### Verify operation
----------------------------------------------------------
1. Source the admin credentials to gain access to admin-only CLI commands:
>source admin-openrc.sh
----------------------------------------------------------
2. List service components to verify successful launch and registration of each process:

>nova service-list

	+----+------------------+----------------------+----------+---------+-------+----------------------------+-----------------+
	| Id | Binary           | Host                 | Zone     | Status  | State | Updated_at                 | Disabled Reason |
	+----+------------------+----------------------+----------+---------+-------+----------------------------+-----------------+
	| 1  | nova-compute     | ubuntu127.thinker.cn | nova     | enabled | up    | 2015-06-08T05:46:40.000000 | -               |
	| 2  | nova-cert        | ubuntu126.thinker.cn | internal | enabled | up    | 2015-06-08T05:46:32.000000 | -               |
	| 3  | nova-consoleauth | ubuntu126.thinker.cn | internal | enabled | up    | 2015-06-08T05:46:39.000000 | -               |
	| 4  | nova-scheduler   | ubuntu126.thinker.cn | internal | enabled | up    | 2015-06-08T05:46:37.000000 | -               |
	| 5  | nova-conductor   | ubuntu126.thinker.cn | internal | enabled | up    | 2015-06-08T05:46:33.000000 | -               |
	+----+------------------+----------------------+----------+---------+-------+----------------------------+-----------------+
----------------------------------------------------------
3. List API endpoints in the Identity service to verify connectivity with the Identity service:

>nova endpoints

	+-----------+----------------------------------------------------------------------+
	| nova      | Value                                                                |
	+-----------+----------------------------------------------------------------------+
	| id        | 03a0191d00ce4b17b437886fe2e277e3                                     |
	| interface | public                                                               |
	| region    | RegionOne                                                            |
	| region_id | RegionOne                                                            |
	| url       | http://ubuntu126.thinker.cn:8774/v2/183a3941e4894767baa3b00fe4742fc8 |
	+-----------+----------------------------------------------------------------------+
	+-----------+----------------------------------------------------------------------+
	| nova      | Value                                                                |
	+-----------+----------------------------------------------------------------------+
	| id        | 06b77dd532d647b9ae5dbcac8c524d65                                     |
	| interface | admin                                                                |
	| region    | RegionOne                                                            |
	| region_id | RegionOne                                                            |
	| url       | http://ubuntu126.thinker.cn:8774/v2/183a3941e4894767baa3b00fe4742fc8 |
	+-----------+----------------------------------------------------------------------+
	+-----------+----------------------------------------------------------------------+
	| nova      | Value                                                                |
	+-----------+----------------------------------------------------------------------+
	| id        | 575bc2d9d9ab44c88ea671160631d215                                     |
	| interface | internal                                                             |
	| region    | RegionOne                                                            |
	| region_id | RegionOne                                                            |
	| url       | http://ubuntu126.thinker.cn:8774/v2/183a3941e4894767baa3b00fe4742fc8 |
	+-----------+----------------------------------------------------------------------+
	WARNING: glance has no endpoint in ! Available endpoints for this service:
	+-----------+----------------------------------+
	| glance    | Value                            |
	+-----------+----------------------------------+
	| id        | 3fbb9272d29044a4af2b22e1bc0bad90 |
	| interface | internal                         |
	| region    | RegionOne                        |
	| region_id | RegionOne                        |
	| url       | http://ubuntu126.thinker.cn:9292 |
	+-----------+----------------------------------+
	+-----------+----------------------------------+
	| glance    | Value                            |
	+-----------+----------------------------------+
	| id        | af7ee84ffacd423e84415fe466eb8a2d |
	| interface | admin                            |
	| region    | RegionOne                        |
	| region_id | RegionOne                        |
	| url       | http://ubuntu126.thinker.cn:9292 |
	+-----------+----------------------------------+
	+-----------+----------------------------------+
	| glance    | Value                            |
	+-----------+----------------------------------+
	| id        | d66db312bbbf4537978c556fb25158f5 |
	| interface | public                           |
	| region    | RegionOne                        |
	| region_id | RegionOne                        |
	| url       | http://ubuntu126.thinker.cn:9292 |
	+-----------+----------------------------------+
	WARNING: keystone has no endpoint in ! Available endpoints for this service:
	+-----------+----------------------------------------+
	| keystone  | Value                                  |
	+-----------+----------------------------------------+
	| id        | 631526688cbe42c9bc5b9d95eb0bdbce       |
	| interface | admin                                  |
	| region    | RegionOne                              |
	| region_id | RegionOne                              |
	| url       | http://ubuntu126.thinker.cn:35357/v2.0 |
	+-----------+----------------------------------------+
	+-----------+---------------------------------------+
	| keystone  | Value                                 |
	+-----------+---------------------------------------+
	| id        | a024da13595c4835969c44d97eecfb12      |
	| interface | public                                |
	| region    | RegionOne                             |
	| region_id | RegionOne                             |
	| url       | http://ubuntu126.thinker.cn:5000/v2.0 |
	+-----------+---------------------------------------+
	+-----------+---------------------------------------+
	| keystone  | Value                                 |
	+-----------+---------------------------------------+
	| id        | a7f17a9d895c44af8633f2b7fd6c22a6      |
	| interface | internal                              |
	| region    | RegionOne                             |
	| region_id | RegionOne                             |
	| url       | http://ubuntu126.thinker.cn:5000/v2.0 |
	+-----------+---------------------------------------+
----------------------------------------------------------
4. List images in the Image service catalog to verify connectivity with the Image service:
>nova image-list

	+--------------------------------------+---------------------+--------+--------+
	| ID                                   | Name                | Status | Server |
	+--------------------------------------+---------------------+--------+--------+
	| a7f244ad-5b73-4c23-a9c4-e7ed368b3fe3 | cirros-0.3.4-x86_64 | ACTIVE |        |
	+--------------------------------------+---------------------+--------+--------+
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------
----------------------------------------------------------


